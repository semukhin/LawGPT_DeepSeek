"""
–ú–æ–¥—É–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å DeepSeek API.
–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∫ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç—É —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤.
–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —Ä–∞–∑–ª–∏—á–∞–µ—Ç –æ–±—ã—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –¥–∏–∞–ª–æ–≥–∞ –æ—Ç —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤.
"""
from typing import Dict, Optional, List, Any, Union
from sqlalchemy.orm import Session 
import logging
import json
import asyncio
from app.handlers.parallel_search import run_parallel_search
from app.utils import measure_time
from app.handlers.es_law_search import search_law_chunks
from app.handlers.web_search import google_search, search_and_scrape, run_multiple_searches
from app.services.deepresearch_service import DeepResearchService
from app.services.deepseek_service import DeepSeekService
from app.models import Message, Thread
from app.config import DEEPSEEK_API_KEY, DEEPSEEK_MODEL
from app.context_manager import ContextManager

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤
deep_research_service = DeepResearchService()
deepseek_service = DeepSeekService(
    api_key=DEEPSEEK_API_KEY, 
    model=DEEPSEEK_MODEL,
    temperature=1.0,    
)

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
context_manager = ContextManager(model=DEEPSEEK_MODEL)

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(level=logging.INFO, format="%(asctime)s - %(levelname)s - %(message)s")


# –î–æ–±–∞–≤–∏—Ç—å –≤ –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞
MAX_PROMPT_CHARS = 30000  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –∏—Ç–æ–≥–æ–≤–æ–≥–æ –ø—Ä–æ–º—Ç–∞
MAX_SEARCH_RESULTS_CHARS = 10000  # –õ–∏–º–∏—Ç –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞
MAX_ES_RESULT_CHARS = 10000  # –õ–∏–º–∏—Ç –Ω–∞ –æ–¥–∏–Ω —Ñ—Ä–∞–≥–º–µ–Ω—Ç –∏–∑ ElasticSearch
MAX_WEB_RESULT_CHARS = 3800  # –õ–∏–º–∏—Ç –Ω–∞ –æ–¥–∏–Ω –≤–µ–±-—Ä–µ–∑—É–ª—å—Ç–∞—Ç


def log_function_call(function_name: str, arguments: Dict) -> None:
    """–õ–æ–≥–∏—Ä—É–µ—Ç –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ —Å –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏."""
    logging.info(f"üîç –§–£–ù–ö–¶–ò–Ø –í–´–ó–í–ê–ù–ê: {function_name}")
    logging.info(f"üîç –ê–†–ì–£–ú–ï–ù–¢–´: {json.dumps(arguments, ensure_ascii=False)}")


def is_general_query(query: str) -> bool:
    """
    –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∑–∞–ø—Ä–æ—Å –æ–±—â–∏–º (–Ω–µ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–º).
    
    Args:
        query: –¢–µ–∫—Å—Ç –∑–∞–ø—Ä–æ—Å–∞
        
    Returns:
        True, –µ—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –æ–±—â–∏–π, False, –µ—Å–ª–∏ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–π
    """
    # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –∑–∞–ø—Ä–æ—Å –≤ –Ω–∏–∂–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
    query_lower = query.lower().strip()
    
    # –°–ø–∏—Å–æ–∫ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤ (–ø—Ä–∏–≤–µ–¥–µ–Ω–Ω—ã–π –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É)
    # –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏
    legal_terms = [
        # –ë–∞–∑–æ–≤—ã–µ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ –ø–æ–Ω—è—Ç–∏—è
        "–∑–∞–∫–æ–Ω", "–∫–æ–¥–µ–∫—Å", "—Å—Ç–∞—Ç—å—è", "–¥–æ–≥–æ–≤–æ—Ä", "–∏—Å–∫", "—É–∫–∞–∑", "–ø–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ", "—Ä–∞—Å–ø–æ—Ä—è–∂–µ–Ω–∏–µ",
        "—Å—É–¥", "–ø—Ä–∞–≤–æ", "—é—Ä–∏—Å—Ç", "–Ω–æ—Ä–º–∞", "—Ä–µ–≥—É–ª–∏—Ä–æ–≤–∞–Ω", "–∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤", "–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç", 
        "–æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤", "–ø—Ä–µ—Ç–µ–Ω–∑–∏", "–≤–∏–Ω–∞", "—É—Å—Ç–∞–≤", "—Å–æ–≥–ª–∞—à–µ–Ω–∏–µ", "–ø—Ä–∏–≥–æ–≤–æ—Ä", "–ø—Ä–æ—Ç–æ–∫–æ–ª",
        "–ø—Ä–∞–≤–æ–º–æ—á–∏", "–ø—Ä–∞–≤–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç", "–¥–µ–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç", "—é—Ä–∏—Å–¥–∏–∫—Ü", "—Å—É–±—ä–µ–∫—Ç", "–æ–±—ä–µ–∫—Ç –ø—Ä–∞–≤–∞",
        "–ø—Ä–∞–≤–æ–æ—Ç–Ω–æ—à–µ–Ω–∏", "–ø—Ä–∞–≤–æ–ø—Ä–µ–µ–º—Å—Ç–≤", "–ø—Ä–µ–∑—É–º–ø—Ü", "—é—Å—Ç–∏—Ü", "–ø—Ä–∞–≤–æ–ø—Ä–∏–º–µ–Ω–µ–Ω", "–ø—Ä–∞–≤–æ–Ω–∞–¥–µ–ª–µ–Ω",
        "–¥–µ–ª–∏–∫—Ç", "–¥–µ–∫—Ä–µ—Ç", "–¥–æ–∫—Ç—Ä–∏–Ω", "–ø—Ä–µ—Ü–µ–¥–µ–Ω—Ç", "—Å–∞–Ω–∫—Ü–∏", "–¥–∏—Å–ø–æ–∑–∏—Ü", "–≥–∏–ø–æ—Ç–µ–∑", "–ø—Ä–∞–≤–æ–ø–æ—Ä—è–¥–æ–∫",
        "–ª–µ–≥–∏—Ç–∏–º–Ω", "–ª–µ–≥–∞–ª–∏–∑–∞—Ü", "–∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü", "—é—Ä–∏–¥–∏—á–µ—Å–∫", "—É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω", "–∑–∞–≤–µ—Ä–µ–Ω",
        
        # –û—Ç—Ä–∞—Å–ª–∏ –ø—Ä–∞–≤–∞
        "–∫–æ–Ω—Å—Ç–∏—Ç—É—Ü–∏–æ–Ω", "–≥—Ä–∞–∂–¥–∞–Ω—Å–∫", "—É–≥–æ–ª–æ–≤–Ω", "–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏", "—Ç—Ä—É–¥–æ–≤", "–Ω–∞–ª–æ–≥–æ–≤", "–∑–µ–º–µ–ª—å–Ω",
        "—Å–µ–º–µ–π–Ω", "–∂–∏–ª–∏—â–Ω", "—ç–∫–æ–ª–æ–≥–∏—á–µ—Å–∫", "–∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω", "–∫–æ–º–º–µ—Ä—á–µ—Å–∫", "—Ñ–∏–Ω–∞–Ω—Å–æ–≤", "–≤–∞–ª—é—Ç–Ω",
        "—Ç–∞–º–æ–∂–µ–Ω–Ω", "–º–µ–¥–∏—Ü–∏–Ω—Å–∫", "–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω", "–∞–≤—Ç–æ—Ä—Å–∫", "–∞–Ω—Ç–∏–º–æ–Ω–æ–ø–æ–ª—å–Ω", "–∞—Ä–±–∏—Ç—Ä–∞–∂–Ω", 
        "–±–∞–Ω–∫–æ–≤—Å–∫", "–±—é–¥–∂–µ—Ç–Ω", "–≤–æ–¥–Ω", "–≤–æ–∑–¥—É—à–Ω", "–≥—Ä–∞–¥–æ—Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω", "–∏–∑–±–∏—Ä–∞—Ç–µ–ª—å–Ω", "–∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω",
        "—Å—Ç—Ä–∞—Ö–æ–≤", "–ª–µ—Å–Ω", "–º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω", "–º–∏–≥—Ä–∞—Ü–∏–æ–Ω", "–Ω–æ—Ç–∞—Ä–∏–∞–ª—å–Ω", "–ø–∞—Ç–µ–Ω—Ç–Ω", "–ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å—Å–∫",
        "–ø—Ä–∏—Ä–æ–¥–æ—Ä–µ—Å—É—Ä—Å–Ω", "–ø—Ä–æ—Ü–µ—Å—Å—É–∞–ª—å–Ω", "–ø—É–±–ª–∏—á–Ω", "—Ä–µ–∫–ª–∞–º–Ω", "—Å–æ—Ü–∏–∞–ª—å–Ω", "—Å–ø–æ—Ä—Ç–∏–≤–Ω", 
        "—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω", "—ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫", "–≤–æ–µ–Ω–Ω",
        
        # –°—É–¥–æ–ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ –∏ –ø—Ä–æ—Ü–µ—Å—Å
        "–∏—Å—Ç–µ—Ü", "–æ—Ç–≤–µ—Ç—á–∏–∫", "—Ç—Ä–µ—Ç—å–µ –ª–∏—Ü–æ", "–∑–∞—è–≤–∏—Ç–µ–ª", "–∞–ø–µ–ª–ª—è—Ü–∏", "–∫–∞—Å—Å–∞—Ü–∏", "–Ω–∞–¥–∑–æ—Ä", "–∏–Ω—Å—Ç–∞–Ω—Ü",
        "—Å—É–¥—å—è", "–ø—Ä–∏—Å—è–∂–Ω", "–∑–∞—Å–µ–¥–∞—Ç–µ–ª", "–∞–¥–≤–æ–∫–∞—Ç", "–ø—Ä–æ–∫—É—Ä–æ—Ä", "–ø—Ä–æ—Ü–µ—Å—Å", "—Ä–∞–∑–±–∏—Ä–∞—Ç–µ–ª—å—Å—Ç–≤",
        "—Å–ª—É—à–∞–Ω", "–ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω", "–≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω", "–æ—Ç–ª–æ–∂–µ–Ω", "—Ö–æ–¥–∞—Ç–∞–π—Å—Ç–≤", "–¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤",
        "—ç–∫—Å–ø–µ—Ä—Ç–∏–∑", "–∂–∞–ª–æ–±", "–ø—Ä–æ—Ç–µ—Å—Ç", "–æ–ø—Ä–æ–≤–µ—Ä–∂–µ–Ω", "–º–æ—Ç–∏–≤–∏—Ä–æ–≤–∫", "–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω", "—Å—Ä–æ–∫",
        "—Å–≤–∏–¥–µ—Ç–µ–ª", "–ø–æ–∫–∞–∑–∞–Ω–∏", "–¥–æ–ø—Ä–æ—Å", "–æ—á–Ω", "—Å—Ç–∞–≤–∫", "–æ—Ç–≤–æ–¥", "—Å–∞–º–æ–æ—Ç–≤–æ–¥", "–ø—Ä–µ–¥—Å–µ–¥–∞—Ç–µ–ª—å—Å—Ç–≤",
        "–ø—Ä–æ—Ç–æ–∫–æ–ª", "—Å—Ç–µ–Ω–æ–≥—Ä–∞–º–º", "–∞—É–¥–∏–æ–∑–∞–ø–∏—Å", "–≤–∏–¥–µ–æ–∑–∞–ø–∏—Å", "–∞—Ä–±–∏—Ç—Ä–∞–∂", "–¥–æ—Å—É–¥–µ–±–Ω", "–º–µ–¥–∏–∞—Ü–∏",
        "–º–∏—Ä–æ–≤–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω", "—Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω", "–ø–µ—Ä–µ—Å–º–æ—Ç—Ä", "—á–∞—Å—Ç–Ω", "–æ–ø—Ä–µ–¥–µ–ª–µ–Ω", "—Å–µ–∫—Ä–µ—Ç–∞—Ä",
        "–ø—Ä–∏–æ–±—â–µ–Ω", "–≤–æ–∑—Ä–∞–∂–µ–Ω", "–æ—Ç–∫–∞–∑", "–ø—Ä–∏–∑–Ω–∞–Ω", "—É—Å–∫–æ—Ä–µ–Ω", "—É–ø—Ä–æ—â–µ–Ω", "–æ—Ç–≤–æ–¥", "–ø—Ä–∏–≤–ª–µ—á–µ–Ω",
        "—Å–æ–¥–µ–π—Å—Ç–≤–∏", "—Ç—Ä–∞–∫—Ç–æ–≤–∫", "–∑–∞–∫–ª—é—á–µ–Ω", "–ø—Ä–∞–≤–æ–ø—Ä–∏–º–µ–Ω", "–≤–∑—ã—Å–∫–∞–Ω", "–ø–æ—à–ª–∏–Ω",
        
        # –î–æ–∫—É–º–µ–Ω—Ç—ã, –∞–∫—Ç—ã, —Ñ–æ—Ä–º—ã
        "—É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω", "—Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤", "—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç", "–≤—ã–ø–∏—Å–∫", "–µ–≥—Ä—é–ª", "–µ–≥—Ä–∏–ø", "–µ–≥—Ä–Ω", 
        "—Å–ø—Ä–∞–≤–∫", "–∑–∞–ø—Ä–æ—Å", "–ø–∏—Å—å–º", "—É–≤–µ–¥–æ–º–ª–µ–Ω", "—Ä–µ—à–µ–Ω", "–æ—Ñ–µ—Ä—Ç", "–∞–∫—Ü–µ–ø—Ç", "–¥–æ–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç", 
        "–∑–∞–≤–µ—â–∞–Ω", "—Ä–∞—Å–ø–æ—Ä—è–∂–µ–Ω", "–ø—Ä–∏–∫–∞–∑", "—Ä–∞—Å–ø–æ—Ä—è–∂–µ–Ω–∏", "–∞–∫—Ç", "–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏", "—É–∫–∞–∑–∞–Ω",
        "—Ä–µ–∑–æ–ª—é—Ü–∏", "–ø—Ä–µ–¥–ø–∏—Å–∞–Ω–∏", "–¥–∏—Ä–µ–∫—Ç–∏–≤", "–¥–µ–∫–ª–∞—Ä–∞—Ü", "—Ñ–æ—Ä–º", "–±–ª–∞–Ω–∫", "–∑–∞–ø–∏—Å—å",
        "—Ä–∞–∑—Ä–µ—à–µ–Ω", "–ª–∏—Ü–µ–Ω–∑", "–ø–∞—Ç–µ–Ω—Ç", "—Å–æ–≥–ª–∞—Å–∏", "–æ—Ç—á–µ—Ç", "–∏–∑–≤–µ—â–µ–Ω", "–æ–±—ä—è—Å–Ω–µ–Ω", "—Å—á–µ—Ç",
        "–∞—Ç—Ç–µ—Å—Ç–∞—Ç", "–¥–∏–ø–ª–æ–º", "–±—é–ª–ª–µ—Ç–µ–Ω", "—Ä–µ–µ—Å—Ç—Ä", "–∫–æ–º–ø–ª–∞–µ–Ω—Å", "—É–≤–µ–¥–æ–º–ª", "—Ä–∞–∑—ä—è—Å–Ω–µ–Ω",
        
        # –ì—Ä–∞–∂–¥–∞–Ω—Å–∫–æ–µ –ø—Ä–∞–≤–æ
        "—Å–¥–µ–ª–∫", "–∞—Ä–µ–Ω–¥", "–∑–∞–ª–æ–≥", "–Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç", "–Ω–∞—Å–ª–µ–¥—Å—Ç–≤", "–∏–º—É—â–µ—Å—Ç–≤", "—Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç",
        "–¥–æ–ª—è", "–¥–∞—Ä–µ–Ω", "–∫—É–ø–ª", "–ø—Ä–æ–¥–∞–∂", "–æ–±–º–µ–Ω", "—Å—Å—É–¥", "–∑–∞–µ–º", "–∫—Ä–µ–¥–∏—Ç", "–ø–æ—Å—Ç–∞–≤–∫",
        "–ø–æ–¥—Ä—è–¥", "—É—Å–ª—É–≥", "–≤–ª–∞–¥–µ–Ω", "–ø–æ–ª—å–∑–æ–≤–∞–Ω", "—Ä–∞—Å–ø–æ—Ä—è–∂–µ–Ω", "–≤–æ–∑–º–µ—â–µ–Ω", "–∫–æ–º–ø–µ–Ω—Å–∞—Ü",
        "—É—â–µ—Ä–±", "–≤—Ä–µ–¥", "—É–ø—É—â–µ–Ω–Ω", "–≤—ã–≥–æ–¥", "–º–æ—Ä–∞–ª—å–Ω", "–æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤", "–¥–µ–Ω—å–≥–∏", "–¥–∏–≤–∏–¥–µ–Ω–¥",
        "–Ω–µ—É—Å—Ç–æ–π–∫", "–ø–µ–Ω—è", "—à—Ç—Ä–∞—Ñ", "–∑–∞–¥–∞—Ç–æ–∫", "–∞–≤–∞–Ω—Å", "–ø–ª–∞—Ç–µ–∂", "–ø–æ—Ä—è–¥–æ–∫", "—Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω",
        "–ø–æ—Ä—É—á–∏—Ç–µ–ª—å—Å—Ç–≤", "–±–∞–Ω–∫–æ–≤—Å–∫", "–≥–∞—Ä–∞–Ω—Ç–∏", "–Ω–µ–∑–∞–≤–∏—Å–∏–º", "–ø—É–±–ª–∏—á–Ω", "–æ—Ü–µ–Ω", "–≤–∏–Ω–¥–∏–∫–∞—Ü",
        "–Ω–µ–≥–∞—Ç–æ—Ä–Ω", "–ø—Ä–∏–æ–±—Ä–µ—Ç–∞—Ç–µ–ª—å–Ω", "–∏—Å–∫–æ–≤–∞—è –¥–∞–≤–Ω–æ—Å—Ç", "—Ç–æ–≤–∞—Ä", "–ø—Ä–µ–¥–º–µ—Ç", "—Ü–µ–Ω–∞", "—Å—Ä–æ–∫",
        "–∏—Å–ø–æ–ª–Ω–µ–Ω", "—Ä–∞—Å—Ç–æ—Ä–∂–µ–Ω", "–Ω–∞—Ä—É—à–µ–Ω", "–∏–∑–º–µ–Ω–µ–Ω", "–¥–æ–ø–æ–ª–Ω–µ–Ω", "–ø—Ä–æ–ª–æ–Ω–≥–∞—Ü", "–æ—Ç—á—É–∂–¥–µ–Ω",
        
        # –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–µ –ø—Ä–∞–≤–æ –∏ –±–∏–∑–Ω–µ—Å
        "—É—Å—Ç–∞–≤", "–∫–∞–ø–∏—Ç–∞–ª", "—É—á—Ä–µ–¥–∏—Ç–µ–ª", "–∞–∫—Ü–∏–æ–Ω–µ—Ä", "–¥–∏–≤–∏–¥–µ–Ω–¥", "–ª–∏—Ü–æ", "–æ–±—â–µ—Å—Ç–≤–æ", "–ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ",
        "–∫–æ–º–ø–∞–Ω–∏—è", "—Ñ–∏—Ä–º–∞", "—Ö–æ–ª–¥–∏–Ω–≥", "–∫–æ—Ä–ø–æ—Ä–∞—Ü", "–æ–æ–æ", "–∞–æ", "–∑–∞–æ", "–ø–∞–æ", "–Ω–∞–æ", "—Ñ–æ–Ω–¥",
        "–Ω–µ–∫–æ–º–º–µ—Ä—á–µ—Å–∫", "—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü", "—Ä–µ–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü", "–ª–∏–∫–≤–∏–¥–∞—Ü", "–ø—Ä–∏–±—ã–ª—å", "–¥–∏—Ä–µ–∫—Ç–æ—Ä", "—Å–æ–≤–µ—Ç",
        "–ø—Ä–∞–≤–ª–µ–Ω–∏", "–ø—Ä–µ–¥—Å–µ–¥–∞—Ç–µ–ª", "–Ω–∫–æ", "–±–∞–Ω–∫—Ä–æ—Ç—Å—Ç–≤", "–ø—Ä–æ—Ü–µ–¥—É—Ä", "–∫–æ–Ω–∫—É—Ä—Å–Ω", "—É–ø—Ä–∞–≤–ª—è—é—â",
        "—Ç—Ä–µ–±–æ–≤–∞–Ω", "–∫—Ä–µ–¥–∏—Ç–æ—Ä", "–¥–æ–ª–∂–Ω–∏–∫", "–∞—É–¥–∏—Ç", "–æ—Ç—á–µ—Ç–Ω–æ—Å—Ç", "–±–∞–ª–∞–Ω—Å", "–∞–∫—Ç–∏–≤", "–ø–∞—Å—Å–∏–≤",
        "—Ä–µ–∑–µ—Ä–≤", "–∏–º—É—â–µ—Å—Ç–≤", "–∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü", "–∞–º–æ—Ä—Ç–∏–∑–∞—Ü", "—É—á–µ—Ç", "—Ñ–æ–Ω–¥", "—Å–∫—É–ø–∫", "–∞–∫—Ü–∏",
        "—É—á–∞—Å—Ç–Ω–∏–∫", "–≤–∫–ª–∞–¥", "–¥–æ–ª–µ–≤", "–∫–æ–Ω—Ç—Ä–æ–ª—å–Ω", "–º–∏–Ω–æ—Ä–∏—Ç–∞—Ä–Ω", "–ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–µ–Ω", "–Ω–æ–º–∏–Ω–∞–ª—å–Ω",
        "—É—Å—Ç–∞–≤", "—Å–æ–±—Ä–∞–Ω–∏", "—Å–æ–≤–µ—Ç", "—Ä–µ—à–µ–Ω–∏", "–¥–æ—Ö–æ–¥", "–ø—Ä–∏–±—ã–ª—å", "–¥–∏–≤–∏–¥–µ–Ω–¥", "–∫–≤–∞—Ä—Ç–∞–ª—å–Ω",
        "–≥–æ–¥–æ–≤", "–±—é–¥–∂–µ—Ç", "–∏—Å–ø–æ–ª–Ω–µ–Ω", "–æ—Å–≤–æ–µ–Ω",
        
        # –£–≥–æ–ª–æ–≤–Ω–æ–µ –ø—Ä–∞–≤–æ
        "–ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω", "–ø—Ä–æ—Å—Ç—É–ø–æ–∫", "–ø—Ä–∞–≤–æ–Ω–∞—Ä—É—à–µ–Ω", "—É–º—ã—Å–µ–ª", "–Ω–µ–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç", "–≤–∏–Ω–∞", 
        "–ø–æ–¥–æ–∑—Ä–µ–≤–∞–µ–º", "–æ–±–≤–∏–Ω—è–µ–º", "–ø–æ–¥—Å—É–¥–∏–º", "–æ—Å—É–∂–¥–µ–Ω–Ω", "—Ä–µ–∞–±–∏–ª–∏—Ç–∞—Ü", "—Å—É–¥–∏–º–æ—Å—Ç", 
        "–Ω–∞–∫–∞–∑–∞–Ω", "–ª–∏—à–µ–Ω", "—Å–≤–æ–±–æ–¥", "–æ–≥—Ä–∞–Ω–∏—á–µ–Ω", "—Å—Ä–æ–∫", "–∞—Ä–µ—Å—Ç", "–∑–∞–∫–ª—é—á–µ–Ω", "–≤–æ–∑–º–µ—â–µ–Ω", 
        "—É—â–µ—Ä–±", "–ø–æ–¥—Å–ª–µ–¥—Å—Ç–≤–µ–Ω–Ω", "—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª", "–¥–æ–∑–Ω–∞–≤–∞—Ç–µ–ª", "–æ–ø–µ—Ä", "–æ—Ç–¥–µ–ª", "–ø–æ–ª–∏—Ü", 
        "–≤—ã–º–æ–≥–∞—Ç–µ–ª—å—Å—Ç–≤", "—à–∞–Ω—Ç–∞–∂", "–∏–∑–Ω–∞—Å–∏–ª–æ–≤–∞–Ω", "–ø–æ–±–æ–∏", "—É–±–∏–π—Å—Ç–≤", "–≥—Ä–∞–±–µ–∂", "—Ä–∞–∑–±–æ–π", 
        "–∫—Ä–∞–∂–∞", "—Ö–∏—â–µ–Ω", "–≤–∑—è—Ç–∫", "–ø–æ–¥–∫—É–ø", "–º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤", "–ø—Ä–µ–≤—ã—à–µ–Ω", "–∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω", 
        "–ø–æ–ª–Ω–æ–º–æ—á", "–ø–æ–¥—Å—Ç—Ä–µ–∫–∞—Ç–µ–ª—å—Å—Ç–≤", "–∏—Å–ø–æ–ª–Ω–µ–Ω", "—Å–æ—É—á–∞—Å—Ç–∏", "–ø–æ—Å–æ–±–Ω–∏—á–µ—Å—Ç–≤", "—Ä–µ—Ü–∏–¥–∏–≤", 
        "–æ—Å–≤–æ–±–æ–∂–¥–µ–Ω", "–∫–æ–Ω—Ñ–∏—Å–∫–∞—Ü", "—à—Ç—Ä–∞—Ñ", "–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω", "–∏–∑–æ–ª—è—Ü–∏", "–æ–±—ã—Å–∫", "–≤—ã–µ–º–∫", 
        "—Å–ª–µ–¥—Å—Ç–≤–µ–Ω–Ω", "–¥–µ–π—Å—Ç–≤–∏", "–æ–ø–æ–∑–Ω–∞–Ω", "–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü", "–æ—á–Ω", "—Å—Ç–∞–≤–∫", "—ç–∫—Å–ø–µ—Ä—Ç–∏–∑", 
        "–∑–∞–∫–ª—é—á–µ–Ω", "–≤—ã–µ–∑–¥", "–ø—Ä–∏–±—ã—Ç", "—è–≤–∫", "–∑–∞–¥–µ—Ä–∂–∞–Ω", "—Å–∞–Ω–∫—Ü–∏", "–ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω", "—Å—Ç–∞—Ç—å—è", 
        "—á–∞—Å—Ç—å", "–ø—É–Ω–∫—Ç", "–ø—Ä–∏–º–µ—á–∞–Ω", "–Ω–æ—Ä–º–∞—Ç–∏–≤–Ω", "–ø–æ—Å—Ç–∞—Ç–µ–π–Ω", 
        
        # –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å
        "–ø–∞—Ç–µ–Ω—Ç", "—Ç–æ–≤–∞—Ä–Ω", "–∑–Ω–∞–∫", "–∞–≤—Ç–æ—Ä—Å–∫", "—Å–º–µ–∂–Ω", "–∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω", "–ª–∏—Ü–µ–Ω–∑–∏", "—Å–æ–∞–≤—Ç–æ—Ä", 
        "–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω", "–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω", "–∫–æ–ø–∏—Ä–æ–≤–∞–Ω", "—Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω", "–ø–ª–∞–≥–∏–∞—Ç", "—ç–∫–∑–µ–º–ø–ª—è—Ä", 
        "—Ä–æ—è–ª—Ç–∏", "–∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω", "—Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç", "–∏–∑–æ–±—Ä–µ—Ç–µ–Ω", "–ø–æ–ª–µ–∑–Ω", "–º–æ–¥–µ–ª", "–∑–∞—â–∏—Ç", 
        "–æ—Ö—Ä–∞–Ω", "–æ–±—ä–µ–∫—Ç", "—Å—É–±—ä–µ–∫—Ç", "–Ω–∞—Ä—É—à–µ–Ω", "–≤–∑—ã—Å–∫–∞–Ω", "–∫–æ–º–ø–µ–Ω—Å–∞—Ü", "–æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω", 
        "–∏–Ω—Ç–µ—Ä–Ω–µ—Ç", "—Å–∞–π—Ç", "–¥–æ–º–µ–Ω", "–¥–∏–∑–∞–π–Ω", "–ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω", "–æ–±—Ä–∞–∑–µ—Ü", "–Ω–æ—É-—Ö–∞—É", "—Å–µ–∫—Ä–µ—Ç", 
        "–ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤", "–∫–æ–º–º–µ—Ä—á–µ—Å–∫", "—Ç–∞–π–Ω", "—Ñ–∏—Ä–º–µ–Ω–Ω", "–Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω", "—Ç–æ–≤–∞—Ä–Ω", "–∑–Ω–∞–∫", 
        "–≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫", "—É–∫–∞–∑–∞–Ω", "–ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω", "–∞–≤—Ç–æ—Ä", "–ø—Ä–∞–≤–æ–æ–±–ª–∞–¥–∞—Ç–µ–ª", "–∏–∑–æ–±—Ä–µ—Ç–∞—Ç–µ–ª", 
        "—Å–µ–ª–µ–∫—Ü–∏–æ–Ω–Ω", "–¥–æ—Å—Ç–∏–∂–µ–Ω",
        
        # –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–µ –ø—Ä–∞–≤–æ
        "–∂–∞–ª–æ–±", "–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω", "–≤–∑—ã—Å–∫–∞–Ω", "—à—Ç—Ä–∞—Ñ", "–ø—Ä–æ—Å—Ç—É–ø–æ–∫", "–ø—Ä–∞–≤–æ–Ω–∞—Ä—É—à–µ–Ω–∏", "–ø—Ä–æ—Ç–æ–∫–æ–ª", 
        "–∞–∫—Ç", "–ø–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω", "—Ä–µ—à–µ–Ω–∏", "–ø—Ä–µ–¥–ø–∏—Å–∞–Ω–∏", "–∫–æ–Ω—Ç—Ä–æ–ª", "–Ω–∞–¥–∑–æ—Ä", "—Ñ–µ–¥–µ—Ä–∞–ª—å–Ω", 
        "—Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω", "–º–µ—Å—Ç–Ω", "—Å–∞–º–æ—É–ø—Ä–∞–≤–ª–µ–Ω", "–æ—Ä–≥–∞–Ω", "–≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω", "–º—É–Ω–∏—Ü–∏–ø–∞–ª—å–Ω", 
        "—Å–ª—É–∂–±", "—á–∏–Ω–æ–≤–Ω–∏–∫", "–¥–æ–ª–∂–Ω–æ—Å—Ç–Ω", "–∏–Ω—Å–ø–µ–∫—Ç–æ—Ä", "–ø—Ä–æ–≤–µ—Ä–∫", "–ø–ª–∞–Ω–æ–≤–∞—è", "–≤–Ω–µ–ø–ª–∞–Ω–æ–≤–∞—è", 
        "–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥", "—Ä–µ–≤–∏–∑–∏", "–∞—Ç—Ç–µ—Å—Ç–∞—Ü", "–ª–∏—Ü–µ–Ω–∑", "—Ä–∞–∑—Ä–µ—à–µ–Ω", "—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω", "—É–≤–µ–¥–æ–º–ª–µ–Ω", 
        "—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü", "–ø—Ä–æ—Ü–µ–¥—É—Ä", "–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü", "–∑–∞—è–≤–ª–µ–Ω", "–æ–±–∂–∞–ª–æ–≤–∞–Ω",
        
        # –¢—Ä—É–¥–æ–≤–æ–µ –ø—Ä–∞–≤–æ
        "—Ç—Ä—É–¥–æ–≤", "–¥–æ–≥–æ–≤–æ—Ä", "–∫–æ–Ω—Ç—Ä–∞–∫—Ç", "—Ä–∞–±–æ—Ç–Ω–∏–∫", "—Å–æ—Ç—Ä—É–¥–Ω–∏–∫", "—Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª", "–≥—Ä–∞—Ñ–∏–∫", 
        "—Ä–µ–∂–∏–º", "–æ—Ç–ø—É—Å–∫", "–±–æ–ª—å–Ω–∏—á–Ω", "–ø–æ—Å–æ–±–∏", "–∫–æ–ª–ª–µ–∫—Ç–∏–≤–Ω", "–ø—Ä–æ—Ñ—Å–æ—é–∑", "—É–≤–æ–ª—å–Ω–µ–Ω", 
        "—Å–æ–∫—Ä–∞—â–µ–Ω", "—à—Ç–∞—Ç", "–ø—Ä–∏–µ–º", "–ø–µ—Ä–µ–≤–æ–¥", "–ø–µ—Ä–µ–º–µ—â–µ–Ω", "–∫–æ–º–∞–Ω–¥–∏—Ä–æ–≤–∫", "–∑–∞—Ä–∞–±–æ—Ç–Ω", 
        "–ø–ª–∞—Ç", "–∞–≤–∞–Ω—Å", "–∫–æ–º–ø–µ–Ω—Å–∞—Ü", "–∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü", "–∫–∞—Ç–µ–≥–æ—Ä", "—Ä–∞–∑—Ä—è–¥", "–¥–æ–ª–∂–Ω–æ—Å—Ç", 
        "–∏–Ω—Å—Ç—Ä—É–∫—Ü", "—Ä–µ–≥–ª–∞–º–µ–Ω—Ç", "–¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞—Ä–Ω", "–ø–æ–æ—â—Ä–µ–Ω", "–≤–∑—ã—Å–∫–∞–Ω", "–º–∞—Ç–µ—Ä–∏–∞–ª—å–Ω", 
        "–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç", "–∏—Å–ø—ã—Ç–∞—Ç–µ–ª—å–Ω", "—Å—Ä–æ–∫", "—Å—Ç–∞–∂", "–ø—Ä–æ–≥—É–ª", "–æ–ø–æ–∑–¥–∞–Ω", "–æ—Ç–≥—É–ª", 
        "–ø—Ä–æ—Å—Ç–æ–π", "–ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫", "—Å–≤–µ—Ä—Ö—É—Ä–æ—á–Ω", "–Ω–æ—á–Ω", "—Ç—Ä—É–¥", "–≤–∞–∫–∞–Ω—Å–∏—è", "–≤—ã—Ö–æ–¥–Ω", 
        "–æ—Ç—Ä–∞–±–æ—Ç–∫", "–±–æ–ª—å–Ω–∏—á–Ω", "–ª–∏—Å—Ç", "—Å—Ç—Ä–∞—Ö–æ–≤–∫", "–ø–µ–Ω—Å–∏–æ–Ω–Ω", "–Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω", "—Å—Ç—Ä–∞—Ö–æ–≤", 
        "–ø–æ—Å–æ–±–∏", "–¥–µ—Ç—Å–∫", "–¥–µ–∫—Ä–µ—Ç–Ω", "–æ—Ç–ø—É—Å–∫", "–±–µ—Ä–µ–º–µ–Ω–Ω", "—Ç–∫",
        
        # –°–µ–º–µ–π–Ω–æ–µ –ø—Ä–∞–≤–æ
        "–±—Ä–∞–∫", "—Ä–∞–∑–≤–æ–¥", "—Å—É–ø—Ä—É–≥", "—Ä–∞–∑–¥–µ–ª", "–∏–º—É—â–µ—Å—Ç–≤", "–∞–ª–∏–º–µ–Ω—Ç", "–æ–ø–µ–∫", "—É—Å—ã–Ω–æ–≤–ª–µ–Ω", 
        "–ø–æ–ø–µ—á–∏—Ç–µ–ª—å—Å—Ç–≤", "—Ä–µ–±–µ–Ω–æ–∫", "–¥–µ—Ç–∏", "—Ä–æ–¥–∏—Ç–µ–ª", "–º–∞—Ç—å", "–æ—Ç–µ—Ü", "–æ—Ç—Ü–æ–≤—Å—Ç–≤", "–º–∞—Ç–µ—Ä–∏–Ω—Å—Ç–≤", 
        "–±—Ä–∞—á–Ω", "–¥–æ–≥–æ–≤–æ—Ä", "–∫–æ–Ω—Ç—Ä–∞–∫—Ç", "—Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤", "—Ä–æ–∂–¥–µ–Ω–∏", "—Å–º–µ—Ä—Ç", "–∑–∞–≥—Å", 
        "–ª–∏—à–µ–Ω", "—Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫", "–ø—Ä–∞–≤", "–ø–æ—Ä—è–¥–æ–∫", "–æ–±—â–µ–Ω", "–ø–µ–Ω—Å–∏–æ–Ω", "—Ñ–æ–Ω–¥", "–Ω–∞—á–∏—Å–ª–µ–Ω", 
        "—É–¥–µ—Ä–∂–∞–Ω", "–¥–æ–±—Ä–æ–≤–æ–ª—å–Ω", "–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω", "–Ω–µ—É–ø–ª–∞—Ç", "–∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç", "–∏–Ω–¥–µ–∫—Å–∞—Ü", 
        "–ø–µ—Ä–µ—Ä–∞—Å—á–µ—Ç", "–æ—Ä–≥–∞–Ω–∏—á–µ–Ω", "–¥–µ–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç", "–Ω–µ–¥–µ–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç", "—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω", "—Å—É–¥", 
        "—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏", "–æ—Ç–Ω–æ—à–µ–Ω", "—Ä–∞—Å—Ç–æ—Ä–∂–µ–Ω", "–±–ª–∏–∑–∫", "—Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏–∫", "–≤–æ—Å–ø–∏—Ç–∞–Ω",
        
        # –ñ–∏–ª–∏—â–Ω–æ–µ –ø—Ä–∞–≤–æ
        "–∂–∏–ª–∏—â–Ω", "–∂–∏–ª–æ–µ", "–ø–æ–º–µ—â–µ–Ω–∏", "–∫–≤–∞—Ä—Ç–∏—Ä", "–¥–æ–º", "–∫–æ–º–Ω–∞—Ç", "—Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫", "–Ω–∞–Ω–∏–º–∞—Ç–µ–ª—å", 
        "–∞—Ä–µ–Ω–¥", "–Ω–∞–π–º", "–ø–æ–¥–Ω–∞–π–º", "–∂–∫—Ö", "–∫–æ–º–º—É–Ω–∞–ª—å–Ω", "—Ç–∞—Ä–∏—Ñ", "—É—Å–ª—É–≥", "—É–ø—Ä–∞–≤–ª—è—é—â", 
        "–∫–æ–º–ø–∞–Ω", "—Ç—Å–∂", "—Ç–æ–≤–∞—Ä–∏—â–µ—Å—Ç–≤", "–∂–∏–ª–µ—Ü", "–ø—Ä–æ–ø–∏—Å–∫", "—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü", "–≤—Ä–µ–º–µ–Ω–Ω", "–ø–æ—Å—Ç–æ—è–Ω–Ω", 
        "–≤—ã–ø–∏—Å–∫", "–≤—Å–µ–ª–µ–Ω", "–≤—ã—Å–µ–ª–µ–Ω", "–ø—Ä–∏–≤–∞—Ç–∏–∑–∞—Ü", "–±—Ä–µ–º—è", "—Å–æ–¥–µ—Ä–∂–∞–Ω", "–∫–∞–ø–∏—Ç–∞–ª—å–Ω", 
        "—Ä–µ–º–æ–Ω—Ç", "—Ç–µ–∫—É—â", "–¥–æ–ª—å—â–∏–∫", "–¥–æ–ª—è", "–Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç", "—Å–Ω–æ—Å", "–≤–µ—Ç—Ö", "–∞–≤–∞—Ä–∏–π–Ω", 
        "–Ω–æ–≤–æ—Å—Ç—Ä–æ–π–∫", "–∑–∞—Å—Ç—Ä–æ–π—â–∏–∫", "–æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤", "–ø–µ—Ä–µ–¥–∞—á–∞", "—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü", "–ø–µ—Ä–µ—É—Å—Ç—É–ø–∫", 
        "—É—Å—Ç—É–ø–∫", "—Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç", "–ø—Ä–∏–∑–Ω–∞–Ω–∏", "—Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏–∫", "–ø—Ä–æ–ø–∏—Å", "–ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫", 
        "—Ä–µ–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü", "–∑–∞—Å—Ç—Ä–æ–π–∫", "–ø–ª–∞–Ω", "–∑–µ–º–µ–ª—å–Ω", "—É—á–∞—Å—Ç–æ–∫", "—Å–Ω—Ç", "–∏–∂—Å", "–≥–∞–∑", 
        "—ç–ª–µ–∫—Ç—Ä", "–≤–æ–¥–∞", "—Å–≤–µ—Ç", "—Ç–µ–ø–ª–æ—Å–Ω–∞–±–∂–µ–Ω",
        
        # –ó–µ–º–µ–ª—å–Ω–æ–µ –ø—Ä–∞–≤–æ
        "–∑–µ–º–µ–ª—å–Ω", "—É—á–∞—Å—Ç–æ–∫", "–∫–∞–¥–∞—Å—Ç—Ä", "–∑–µ–º–ª–µ—É—Å—Ç—Ä–æ–π—Å—Ç–≤", "–º–µ–∂–µ–≤–∞–Ω", "—Å–µ—Ä–≤–∏—Ç—É—Ç", "—Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫", 
        "–∞—Ä–µ–Ω–¥", "–∞—Ä–µ–Ω–¥–∞", "—Å—É–±–∞—Ä–µ–Ω–¥", "—Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç", "–∫–∞—Ç–µ–≥–æ—Ä", "—Ä–∞–∑—Ä–µ—à–µ–Ω–Ω", "–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω", 
        "–∑–æ–Ω–∏—Ä–æ–≤–∞–Ω", "—Å–Ω—Ç", "–¥–Ω–ø", "–∏–∂—Å", "–ª–ø—Ö", "—Ü–µ–ª–µ–≤", "—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü", "–ø–µ—Ä–µ–≤–æ–¥", "—Å–¥–µ–ª–∫", 
        "–≥—Ä–∞–Ω–∏—Ü", "—Å–º–µ–∂–Ω", "–ø–∞–π", "–¥–æ–ª—è", "–ø–æ–ª—å–∑–æ–≤–∞–Ω", "–±–µ—Å—Å—Ä–æ—á–Ω", "–≤—Ä–µ–º–µ–Ω–Ω", "–æ–≥—Ä–∞–∂–¥–µ–Ω", 
        "–∑–∞–º–µ–Ω–µ–Ω", "—É—â–µ—Ä–±", "–∫–æ–º–ø–µ–Ω—Å–∞—Ü", "–ø–ª–∞–Ω–∏—Ä–æ–≤–∫", "–∑–∞—Å—Ç—Ä–æ–π–∫",
        
        # –ù–∞–ª–æ–≥–æ–≤–æ–µ –ø—Ä–∞–≤–æ
        "–Ω–∞–ª–æ–≥", "—Å–±–æ—Ä", "–≤–∑–Ω–æ—Å", "–¥–µ–∫–ª–∞—Ä–∞—Ü", "–≤—ã—á–µ—Ç", "–Ω–¥—Å", "–Ω–¥—Ñ–ª", "–ø—Ä–∏–±—ã–ª—å", "–∏–º—É—â–µ—Å—Ç–≤", 
        "—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω", "–∑–µ–º–µ–ª—å–Ω", "–∞–∫—Ü–∏–∑", "–∏–Ω–Ω", "–∫–ø–ø", "—Å–Ω–∏–ª—Å", "–æ–≥—Ä–Ω", "–Ω–∞–ª–æ–≥–æ–≤", "–æ—Ä–≥–∞–Ω", 
        "–∏–Ω—Å–ø–µ–∫—Ü", "—É–∫–ª–æ–Ω–µ–Ω", "–æ–ø—Ç–∏–º–∏–∑–∞—Ü", "–ª—å–≥–æ—Ç", "–≤–æ–∑–≤—Ä–∞—Ç", "–ø–µ—Ä–µ–ø–ª–∞—Ç", "–∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç", 
        "–ø–µ–Ω—è", "—à—Ç—Ä–∞—Ñ", "–Ω–µ–≤—ã–ø–ª–∞—Ç", "–¥–æ–Ω–∞—á–∏—Å–ª–µ–Ω", "—É–≤–µ–¥–æ–º–ª–µ–Ω", "—Ç—Ä–µ–±–æ–≤–∞–Ω", "–ø—Ä–æ–≤–µ—Ä–∫", 
        "–≤—ã–µ–∑–¥–Ω", "–∫–∞–º–µ—Ä–∞–ª—å–Ω", "–ø–∞—Ç–µ–Ω—Ç", "—É—Å–Ω", "–æ—Å–Ω–æ", "–µ–Ω–≤–¥", "–µ—Å—Ö–Ω", "—Å–∞–º–æ–∑–∞–Ω—è—Ç", "–∏–ø",
        
        # –ó–∞–∫–æ–Ω—ã –∏ –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ –∞–∫—Ç—ã (–ø–æ –Ω–æ–º–µ—Ä–∞–º)
        "44-—Ñ–∑", "44 —Ñ–∑", "223-—Ñ–∑", "223 —Ñ–∑", "214-—Ñ–∑", "214 —Ñ–∑", "229-—Ñ–∑", "229 —Ñ–∑", 
        "230-—Ñ–∑", "230 —Ñ–∑", "259-—Ñ–∑", "259 —Ñ–∑", "263-—Ñ–∑", "263 —Ñ–∑", "290-—Ñ–∑", "290 —Ñ–∑", 
        "353-—Ñ–∑", "353 —Ñ–∑", "94-—Ñ–∑", "94 —Ñ–∑", "115-—Ñ–∑", "115 —Ñ–∑", "127-—Ñ–∑", "127 —Ñ–∑", 
        "62-—Ñ–∑", "62 —Ñ–∑", "131-—Ñ–∑", "131 —Ñ–∑", "152-—Ñ–∑", "152 —Ñ–∑", "273-—Ñ–∑", "273 —Ñ–∑", 
        "53-—Ñ–∑", "53 —Ñ–∑", "79-—Ñ–∑", "79 —Ñ–∑", "7-—Ñ–∑", "",
        
        # –°–æ–∫—Ä–∞—â–µ–Ω–∏—è –∫–æ–¥–µ–∫—Å–æ–≤
        "–≥–∫", "–≥–∫ —Ä—Ñ", "–≥–ø–∫", "–≥–ø–∫ —Ä—Ñ", "—É–ø–∫", "—É–ø–∫ —Ä—Ñ", "—É–∫", "—É–∫ —Ä—Ñ", "–∫–∞—Å", "–∫–∞—Å —Ä—Ñ", 
        "–∫–æ–∞–ø", "–∫–æ–∞–ø —Ä—Ñ", "—Ç–∫", "—Ç–∫ —Ä—Ñ", "–∂–∫", "–∂–∫ —Ä—Ñ", "–∑–∫", "–∑–∫ —Ä—Ñ", "–±–∫", "–±–∫ —Ä—Ñ", 
        "–Ω–∫", "–Ω–∫ —Ä—Ñ", "–∞–ø–∫", "–∞–ø–∫ —Ä—Ñ", "—Å–∫", "—Å–∫ —Ä—Ñ", "–≤–æ–∑–¥—É—à–Ω—ã–π –∫–æ–¥–µ–∫—Å", "–≤–æ–¥–Ω—ã–π –∫–æ–¥–µ–∫—Å", 
        "–ª–µ—Å–Ω–æ–π –∫–æ–¥–µ–∫—Å", "–≥—Ä–∞–¥–æ—Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–¥–µ–∫—Å", "—Ç–∞–º–æ–∂–µ–Ω–Ω—ã–π –∫–æ–¥–µ–∫—Å",
        
        # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω—ã
        "—é—Ä–ª–∏—Ü–æ", "—Ñ–∏–∑–ª–∏—Ü", "–≥—Ä–∞–∂–¥–∞–Ω–∏–Ω", "–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏", "—Ñ–≥—É–ø", "–∞—Å—Ç—Ä–µ–Ω—Ç", "–ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤", 
        "–∑–∞—â–∏—Ç", "–∏–Ω—Ç–µ—Ä–µ—Å", "—Ä–µ–∑–∏–¥–µ–Ω—Ç", "–Ω–µ—Ä–µ–∑–∏–¥–µ–Ω—Ç", "–¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω", "—É–ø—Ä–∞–≤–ª–µ–Ω", "–¥–æ–≤–µ—Ä", 
        "–ª–∏—Ü", "—á–∞—Å—Ç–Ω", "–ø—É–±–ª–∏—á–Ω", "—á–∞—Å—Ç–Ω–æ-–≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω", "–ø–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤", "–∫–æ–Ω—Ü–µ—Å—Å–∏", 
        "–ø—Ä–∏–∫–∞–∑–Ω", "–ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤", "—Å–≤–æ", "–∫–æ–º–±–∞—Ç", "—Å–ø–µ—Ü–∏–∞–ª—å–Ω", "–≤–æ–µ–Ω–Ω", "–æ–ø–µ—Ä–∞—Ü", 
        "–º–æ–±–∏–ª–∏–∑–∞—Ü", "—á–∞—Å—Ç–∏—á–Ω", "–ø–æ–ª–Ω", "–ø—Ä–∏–∑—ã–≤–Ω–∏–∫", "—é—Ä–∏–¥–∏—á–µ—Å–∫", "—Ñ–∞–∫—Ç", "–ø—Ä–∏—Å—è–≥", 
        "–≤–æ–π—Å–∫", "–∫–æ–º–∏—Å—Å–∞—Ä", "—Ä–≤–∫", "–≤–æ–µ–Ω–∫–æ–º–∞—Ç", "–≤—É–∑", "—Å—Ç—É–¥–µ–Ω—Ç", "–æ—Ç—Å—Ä–æ—á–∫", "–¥–∏—Å—Ç–∞–Ω—Ü", 
        "–º–æ—Ä–∞–ª—å–Ω–æ-—ç—Ç–∏—á–µ—Å–∫", "–∞—Å–ø–µ–∫—Ç", "–ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω", "–∞–Ω—Ç–∏–∫–æ—Ä—Ä—É–ø—Ü"
    ]
    
    # –°–ø–∏—Å–æ–∫ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –æ–±—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
    general_patterns = [
        # –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
        "–ø—Ä–∏–≤–µ—Ç", "–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π", "–¥–æ–±—Ä—ã–π –¥–µ–Ω—å", "–¥–æ–±—Ä–æ–µ —É—Ç—Ä–æ", "–¥–æ–±—Ä—ã–π –≤–µ—á–µ—Ä", "–∑–¥–æ—Ä–æ–≤–æ", "—Ö–∞–π",
        "–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é", "—Å–∞–ª—é—Ç", "–¥–æ–±—Ä–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏", "—Ö–µ–ª–ª–æ—É", "–∫—É", "—Ö–æ–ª–∞", "–π–æ—É", "–≤–µ—á–µ—Ä –¥–æ–±—Ä—ã–π",
        
        # –û —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–µ
        "–∫–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç", "–∫—Ç–æ —Ç—ã", "—á—Ç–æ —Ç—ã —É–º–µ–µ—à—å", "—á—Ç–æ —Ç—ã –º–æ–∂–µ—à—å", "—á–µ–º —Ç—ã –∑–∞–Ω–∏–º–∞–µ—à—å—Å—è",
        "—Ä–∞—Å—Å–∫–∞–∂–∏ –æ —Å–µ–±–µ", "–∫–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—à—å—Å—è", "–∫—Ç–æ —Ç–µ–±—è —Å–æ–∑–¥–∞–ª", "–∫—Ç–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–ª",
        "—Ç–≤–æ–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏", "—Ç–≤–æ—è –≤–µ—Ä—Å–∏—è", "—Ç–≤–æ–∏ —Ñ—É–Ω–∫—Ü–∏–∏", "—Ç—ã —Ä–æ–±–æ—Ç", "—Ç—ã –±–æ—Ç", 
        "–∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç", "–Ω–µ–π—Ä–æ–Ω–Ω–∞—è —Å–µ—Ç—å", "–±–æ–ª—å—à–∞—è —è–∑—ã–∫–æ–≤–∞—è –º–æ–¥–µ–ª—å", 
        "–∫–æ–≥–¥–∞ —Ç–µ–±—è —Å–æ–∑–¥–∞–ª–∏", "–≥–¥–µ —Ç—ã –Ω–∞—Ö–æ–¥–∏—à—å—Å—è", "—Ç–≤–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫",
        
        # –í–æ–ø—Ä–æ—Å—ã –æ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–∏
        "–∫–∞–∫ –¥–µ–ª–∞", "–∫–∞–∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ", "–∫–∞–∫ –∂–∏–∑–Ω—å", "–∫–∞–∫ —Ç—ã", "–≤—Å–µ —Ö–æ—Ä–æ—à–æ", 
        "—á—Ç–æ –Ω–æ–≤–æ–≥–æ", "–∫–∞–∫ –ø–æ–∂–∏–≤–∞–µ—à—å", "–∫–∞–∫ —Å–µ–±—è —á—É–≤—Å—Ç–≤—É–µ—à—å", "–∫–∞–∫ —Ç–≤–æ–∏ –¥–µ–ª–∞",
        
        # –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏
        "—Å–ø–∞—Å–∏–±–æ", "–±–ª–∞–≥–æ–¥–∞—Ä—é", "—Å–ø—Å", "–ø–∞—Å–∏–±", "—Å–µ–Ω–∫—Å", "–±–ª–∞–≥–æ–¥–∞—Ä–µ–Ω", "–±–ª–∞–≥–æ–¥–∞—Ä–Ω–∞", 
        "–º–µ—Ä—Å–∏", "–ø—Ä–∏–∑–Ω–∞—Ç–µ–ª–µ–Ω", "–±–æ–ª—å—à–æ–µ —Å–ø–∞—Å–∏–±–æ", "–æ—Ç –¥—É—à–∏", "—Ü–µ–Ω—é", "—Ä–µ—Å–ø–µ–∫—Ç",
        
        # –§—Ä–∞–∑—ã –ø—Ä–æ—â–∞–Ω–∏—è
        "–ø–æ–∫–∞", "–¥–æ —Å–≤–∏–¥–∞–Ω–∏—è", "—É–≤–∏–¥–∏–º—Å—è", "–≤—Å–µ–≥–æ –¥–æ–±—Ä–æ–≥–æ", "–¥–æ –≤—Å—Ç—Ä–µ—á–∏", "–±—ã–≤–∞–π",
        "—É–¥–∞—á–∏", "–ø—Ä–æ—â–∞–π", "–¥–æ —Å–∫–æ—Ä–æ–≥–æ", "–ø–æ–∫–µ–¥–∞", "–±—É–¥—å –∑–¥–æ—Ä–æ–≤", "–ø–æ–∫–µ–¥–æ–≤–∞", "—á–∞–æ",
        
        # –ö–æ–º–ø–ª–∏–º–µ–Ω—Ç—ã –∏ –æ—Ü–µ–Ω–∫–∏
        "–º–æ–ª–æ–¥–µ—Ü", "–æ—Ç–ª–∏—á–Ω–æ", "—Ö–æ—Ä–æ—à–æ", "—Å—É–ø–µ—Ä", "–∫–ª–∞—Å—Å", "–∫—Ä—É—Ç–æ", "–Ω–µ–ø–ª–æ—Ö–æ", "–ø—Ä–µ–∫—Ä–∞—Å–Ω–æ", 
        "–∑–∞–º–µ—á–∞—Ç–µ–ª—å–Ω–æ", "–ø—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω–æ", "–±–ª–µ—Å—Ç—è—â–µ", "–≤–µ–ª–∏–∫–æ–ª–µ–ø–Ω–æ", "–ø–æ—Ç—Ä—è—Å–∞—é—â–µ", "—É–º–Ω–∏—Ü–∞", 
        "—à–∏–∫–∞—Ä–Ω–æ", "–±—Ä–∞–≤–æ", "–≤–ø–µ—á–∞—Ç–ª—è–µ—Ç", "–æ–≥–æ–Ω—å", "–±–æ–º–±–∞",
        
        # –ò–∑–≤–∏–Ω–µ–Ω–∏—è –∏ —Å–æ–∂–∞–ª–µ–Ω–∏—è
        "–∏–∑–≤–∏–Ω–∏", "–ø—Ä–æ—Å—Ç–∏", "—Å–æ—Ä—Ä–∏", "–≤–∏–Ω–æ–≤–∞—Ç", "–ø—Ä–æ—à—É –ø—Ä–æ—â–µ–Ω–∏—è", "–º–Ω–µ –∂–∞–ª—å", "—Å–æ–∂–∞–ª–µ—é", 
        "–Ω–µ —Ö–æ—Ç–µ–ª", "–º–æ—è –æ—à–∏–±–∫–∞", "–º–æ–π –∫–æ—Å—è–∫", "–Ω–µ –æ–±–∏–∂–∞–π—Å—è", "–∏–∑–≤–∏–Ω—è—é—Å—å",
        
        # –°–æ–≥–ª–∞—Å–∏–µ/–Ω–µ—Å–æ–≥–ª–∞—Å–∏–µ
        "—Å–æ–≥–ª–∞—Å–µ–Ω", "–Ω–µ —Å–æ–≥–ª–∞—Å–µ–Ω", "—Ç–∞–∫ —Ç–æ—á–Ω–æ", "–æ—Ç–ª–∏—á–Ω–æ", "–Ω–µ–≤–µ—Ä–Ω–æ", "–ø—Ä–∞–≤–∏–ª—å–Ω–æ", 
        "–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ", "–≤–µ—Ä–Ω–æ", "—Å–æ–≥–ª–∞—à—É—Å—å", "–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é", "–∫–∞—Ç–µ–≥–æ—Ä–∏—á–µ—Å–∫–∏ –Ω–µ—Ç",
        
        # –í–æ–ø—Ä–æ—Å—ã –æ –º–æ–¥–µ–ª–∏
        "–∫–∞–∫—É—é –Ω–µ–π—Ä–æ—Å–µ—Ç—å", "–∫–∞–∫–æ–π –Ω–µ–π—Ä–æ–Ω–Ω–æ–π", "–∫–∞–∫–æ–π llm", "–∫–∞–∫–∞—è –º–æ–¥–µ–ª—å", "–Ω–∞ —á–µ–º —Ä–∞–±–æ—Ç–∞–µ—à—å",
        "–Ω–∞ –∫–∞–∫–æ–π —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏", "–Ω–∞ –∫–∞–∫–æ–π –æ—Å–Ω–æ–≤–µ", "–Ω–∞ –∫–∞–∫–æ–º —è–∑—ã–∫–µ", "deepseek", "claude", "gpt",
        "—Ç–æ–∫–µ–Ω—ã", "–∫–æ–Ω—Ç–µ–∫—Å—Ç", "–æ–±—É—á–µ–Ω–∏–µ", "—è–∑—ã–∫–æ–≤–∞—è –º–æ–¥–µ–ª—å", "–∏–∏", "–∞–∏", "–∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π", "ai",
        "—Å–∫–æ–ª—å–∫–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤", "—Ç–≤–æ—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞", "transformer", "—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä",
        
        # –ö–æ—Ä–æ—Ç–∫–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
        "–æ–∫", "—è—Å–Ω–æ", "–ø–æ–Ω—è–ª", "–ø–æ–Ω—è—Ç–Ω–æ", "–¥–∞", "–Ω–µ—Ç", "–∫–æ–Ω–µ—á–Ω–æ", "—Ä–∞–∑—É–º–µ–µ—Ç—Å—è", "–≤–æ–∑–º–æ–∂–Ω–æ",
        "–∏–º–µ–Ω–Ω–æ", "–Ω–∞–≤–µ—Ä–Ω–æ–µ", "–≤–µ—Ä–æ—è—Ç–Ω–æ", "–æ—á–µ–≤–∏–¥–Ω–æ", "–ª–æ–≥–∏—á–Ω–æ", "–±–µ–∑—É—Å–ª–æ–≤–Ω–æ",
        
        # –ü—Ä–æ—Å—å–±—ã –æ –ø–æ–º–æ—â–∏
        "–ø–æ–º–æ–≥–∏", "–ø–æ–¥—Å–∫–∞–∂–∏", "–ø–æ–º–æ—â—å", "–ø–æ–¥–¥–µ—Ä–∂–∫–∞", "–Ω–µ –ø–æ–Ω–∏–º–∞—é", "–∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç",
        "–æ–±—ä—è—Å–Ω–∏", "—Ä–∞–∑—ä—è—Å–Ω–∏", "—É—Ç–æ—á–Ω–∏", "–∫–∞–∫ –º–Ω–µ", "—á—Ç–æ –¥–µ–ª–∞—Ç—å", "–∫–∞–∫ –±—ã—Ç—å",
        
        # –£–∫–∞–∑–∞–Ω–∏—è –Ω–∞ –æ—à–∏–±–∫–∏
        "–æ—à–∏–±–∫–∞", "—Ç—ã –æ—à–∏–±–∞–µ—à—å—Å—è", "—ç—Ç–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ", "–æ—à–∏–±—Å—è", "–Ω–µ —Ç–∞–∫", "–Ω–µ—Ç–æ—á–Ω–æ",
        "–Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ", "–Ω–µ–ø—Ä–∞–≤–¥–∞", "–ø—É—Ç–∞–µ—à—å", "–∑–∞–±–ª—É–∂–¥–∞–µ—à—å—Å—è", 
        
        # –ü—Ä–æ—Å—å–±—ã –æ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–∏
        "–ø—Ä–æ–¥–æ–ª–∂–∞–π", "–¥–∞–ª—å—à–µ", "—á—Ç–æ –µ—â–µ", "–∏ —á—Ç–æ", "–µ—â–µ", "—Ä–∞—Å—Å–∫–∞–∂–∏ –±–æ–ª—å—à–µ",
        "–ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ", "–¥–∞–ª—å–Ω–µ–π—à–µ–µ", "—Å–ª–µ–¥—É—é—â–µ–µ", "—á—Ç–æ –ø–æ—Ç–æ–º", "–∞ –∑–∞—Ç–µ–º"
    ]

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ —Ç–µ—Ä–º–∏–Ω—ã (–í–°–ï–ì–î–ê –ø–µ—Ä–µ–¥ –¥—Ä—É–≥–∏–º–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏)
    for term in legal_terms:
        if term in query_lower:
            # –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–π —Ç–µ—Ä–º–∏–Ω, —Ç–æ —ç—Ç–æ –Ω–µ –æ–±—â–∏–π –∑–∞–ø—Ä–æ—Å
            return False

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ –∑–∞–ø—Ä–æ—Å –æ–±—â–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
    for pattern in general_patterns:
        if pattern in query_lower:
            return True

    # –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –æ—á–µ–Ω—å –∫–æ—Ä–æ—Ç–∫–∏–π (–º–µ–Ω–µ–µ 4 —Å–ª–æ–≤), —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ —ç—Ç–æ –æ–±—â–∏–π –∑–∞–ø—Ä–æ—Å
    if len(query_lower.split()) < 4 and len(query_lower) < 25:
        return True
    
    # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å—á–∏—Ç–∞–µ–º –∑–∞–ø—Ä–æ—Å —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–º, –µ—Å–ª–∏ –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª–æ—Å—å, —á—Ç–æ –æ–Ω –æ–±—â–∏–π
    return False



@measure_time
async def handle_function_call(function_name: str, arguments: Dict, thread_id: Optional[str] = None, db: Optional[Session] = None) -> Dict:
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–∑–æ–≤–∞ —Ñ—É–Ω–∫—Ü–∏–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º."""
    query = arguments.get("query", "")
    
    # –õ–æ–≥–∏—Ä—É–µ–º –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
    log_function_call(function_name, arguments)

    if function_name == "search_law_chunks":
        try:
            logging.info("üîç –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–∏—Å–∫–∞ –≤ Elasticsearch –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞: '%s'", query)
            es_results = search_law_chunks(query)
            if es_results:
                logging.info(f"‚úÖ –ù–∞–π–¥–µ–Ω–æ {len(es_results)} —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —á–∞–Ω–∫–æ–≤ –≤ Elasticsearch")
                for i, chunk in enumerate(es_results[:2]):  # –í—ã–≤–æ–¥–∏–º –ø–µ—Ä–≤—ã–µ 2 —á–∞–Ω–∫–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
                    logging.info(f"üìÑ –ß–∞–Ω–∫ {i+1}: {chunk[:100]}...")
                
                # –°–æ–µ–¥–∏–Ω—è–µ–º –≤—Å–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —á–∞–Ω–∫–∏ –≤ –æ–¥–∏–Ω —Ç–µ–∫—Å—Ç
                combined_text = "\n\n".join(es_results)
                
                # –ò—Å–ø–æ–ª—å–∑—É–µ–º DeepResearch –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞
                deep_results = await deep_research_service.research(
                    query=combined_text, 
                    thread_id=thread_id,  # –ü–µ—Ä–µ–¥–∞–µ–º thread_id
                    message_id=None, 
                    user_id=None, 
                    db=db  # –ü–µ—Ä–µ–¥–∞–µ–º db
                )
                
                return {
                    "found": True,
                    "chunks_count": len(es_results),
                    "deep_research_results": deep_results.to_dict()
                }
            
            logging.info("‚ùå –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –≤ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.")
            return {"found": False, "error": "–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –≤ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã."}
        except Exception as e:
            logging.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –≤ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–µ: {str(e)}")
            return {"found": False, "error": f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –≤ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–µ: {str(e)}"}


    elif function_name == "search_web":
        try:
            logging.info("üîç –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤–µ–±-–ø–æ–∏—Å–∫–∞ –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞: '%s'", query)
            logs = []
            
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ –≤–º–µ—Å—Ç–æ –ø—Ä–æ—Å—Ç–æ–≥–æ
            search_results = await run_multiple_searches(query, logs)
            
            # –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ —É—Å–ø–µ—à–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–∑ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –ø–æ–∏—Å–∫–∞
            all_results = []
            for search_type, results in search_results.items():
                all_results.extend(results)
            
            if all_results:
                logging.info(f"‚úÖ –ù–∞–π–¥–µ–Ω–æ {len(all_results)} —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü")
                
                # –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
                extracted_texts = []
                for result in all_results:
                    if result.is_successful():
                        extracted_texts.append({
                            "url": result.url,
                            "title": result.title,
                            "text": result.text[:2000]  # –ë–µ—Ä–µ–º –¥–æ 2000 —Å–∏–º–≤–æ–ª–æ–≤ –∏–∑ –∫–∞–∂–¥–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
                        })
                
                combined_text = "\n\n".join([
                    f"–ò—Å—Ç–æ—á–Ω–∏–∫: {item['url']}\n–ó–∞–≥–æ–ª–æ–≤–æ–∫: {item['title']}\n{item['text']}"
                    for item in extracted_texts
                ])
                
                user_id = None
                message_id = None
                if thread_id and db:
                    try:
                        # –ü–æ–ª—É—á–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                        user_message = db.query(Message).filter(
                            Message.thread_id == thread_id,
                            Message.role == "user"
                        ).order_by(Message.created_at.desc()).limit(10).first()
                        
                        if user_message:
                            message_id = user_message.id
                        
                        # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ —Å–≤—è–∑—å —Ç—Ä–µ–¥–∞
                        thread = db.query(Thread).filter(Thread.id == thread_id).first()
                        if thread:
                            user_id = thread.user_id
                    except Exception as e:
                        logging.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è: {e}")

                # –ò—Å–ø–æ–ª—å–∑—É–µ–º DeepResearch –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
                deep_results = await deep_research_service.research(combined_text)
                
                return {
                    "found": True, 
                    "sources_count": len(extracted_texts),
                    "sources": [{"url": item["url"], "title": item["title"]} for item in extracted_texts[:5]],
                    "deep_research_results": deep_results.to_dict()
                }
            
            logging.info("‚ùå –†–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –≤–µ–±-—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.")
            return {"found": False, "error": "–†–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –≤–µ–±-—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã."}
        except Exception as e:
            logging.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–µ–±-–ø–æ–∏—Å–∫–µ: {str(e)}")
            return {"found": False, "error": f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–µ–±-–ø–æ–∏—Å–∫–µ: {str(e)}"}
    
    
    elif function_name == "deep_research":
        try:
            logging.info("üîç –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≥–ª—É–±–æ–∫–æ–≥–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞: '%s'", query)
            
            # –°–æ–±–∏—Ä–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
            logs = []
            additional_context = []
            
            # 1. –ü–æ–∏—Å–∫ –≤ Elasticsearch
            try:
                es_results = search_law_chunks(query)
                if es_results:
                    additional_context.append({
                        "type": "legislation",
                        "found": True,
                        "data": es_results[:10]  # –ë–µ—Ä–µ–º –¥–æ 10 –Ω–∞–∏–±–æ–ª–µ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
                    })
            except Exception as e:
                logging.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏–∑ Elasticsearch: {str(e)}")
            
            # 2. –ü–æ–∏—Å–∫ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ
            try:
                web_results = await run_multiple_searches(query, logs)
                all_web_results = []
                for search_type, results in web_results.items():
                    all_web_results.extend(results)
                
                if all_web_results:
                    extracted_texts = []
                    for result in all_web_results:
                        if result.is_successful():
                            extracted_texts.append({
                                "url": result.url,
                                "title": result.title,
                                "text": result.text[:2000]  # –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                            })
                    
                    if extracted_texts:
                        additional_context.append({
                            "type": "web",
                            "found": True,
                            "data": extracted_texts[:3]  # –ë–µ—Ä–µ–º –¥–æ 3 –Ω–∞–∏–±–æ–ª–µ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
                        })
            except Exception as e:
                logging.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞: {str(e)}")
            
            # –í—ã–ø–æ–ª–Ω—è–µ–º –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Å —É—á–µ—Ç–æ–º –≤—Å–µ–≥–æ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
            deep_results = await deep_research_service.research(query, additional_context)
            
            return {
                "found": True,
                "deep_research_results": deep_results.to_dict()
            }
        except Exception as e:
            logging.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–ª—É–±–æ–∫–æ–º –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–∏: {str(e)}")
            return {"found": False, "error": f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–ª—É–±–æ–∫–æ–º –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–∏: {str(e)}"}
            
    return {"found": False, "error": f"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è: {function_name}"}


# –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ö–µ–º —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è DeepSeek API
AVAILABLE_FUNCTIONS = [
    {
        "name": "search_law_chunks",
        "description": "–ü–æ–∏—Å–∫ –≤ –±–∞–∑–µ —Ä–æ—Å—Å–∏–π—Å–∫–æ–≥–æ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –ø–æ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É –∑–∞–ø—Ä–æ—Å—É. –ò—Å–ø–æ–ª—å–∑—É–π —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –æ –∑–∞–∫–æ–Ω–∞—Ö, –ø—Ä–∞–≤–æ–≤—ã—Ö –Ω–æ—Ä–º–∞—Ö, –≥—Ä–∞–∂–¥–∞–Ω—Å–∫–æ–º –∫–æ–¥–µ–∫—Å–µ, –∏ –¥—Ä—É–≥–∏—Ö –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å–Ω—ã—Ö –∞–∫—Ç–∞—Ö.",
        "parameters": {
            "type": "object",
            "properties": {
                "query": {
                    "type": "string",
                    "description": "–¢–µ–∫—Å—Ç –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–µ. –î–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫–ª—é—á–µ–≤—ã–µ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ —Ç–µ—Ä–º–∏–Ω—ã –∏ –Ω–æ–º–µ—Ä–∞ —Å—Ç–∞—Ç–µ–π, –µ—Å–ª–∏ –∏–∑–≤–µ—Å—Ç–Ω—ã."
                }
            },
            "required": ["query"]
        }
    },
    {
        "name": "search_web",
        "description": "–ü–æ–∏—Å–∫ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ –ø–æ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É –∑–∞–ø—Ä–æ—Å—É. –ò—Å–ø–æ–ª—å–∑—É–π –¥–ª—è –ø–æ–∏—Å–∫–∞ —Å—É–¥–µ–±–Ω–æ–π –ø—Ä–∞–∫—Ç–∫–∏–∏, –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, —Å—Ç–∞—Ç–µ–π, –∏ –æ–±–∑–æ—Ä–æ–≤.",
        "parameters": {
            "type": "object",
            "properties": {
                "query": {
                    "type": "string",
                    "description": "–¢–µ–∫—Å—Ç –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ. –ó–∞–ø—Ä–æ—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞–Ω —Ç–∞–∫, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ —Ç–µ–º–µ."
                }
            },
            "required": ["query"]
        }
    },
    {
        "name": "deep_research",
        "description": "–ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ –≥–ª—É–±–æ–∫–æ–≥–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –ø–æ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É –∑–∞–ø—Ä–æ—Å—É. –ò—Å–ø–æ–ª—å–∑—É–π –¥–ª—è –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–∞–≤–æ–≤—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–π–¥–µ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.",
        "parameters": {
            "type": "object",
            "properties": {
                "query": {
                    "type": "string",
                    "description": "–¢–µ–∫—Å—Ç –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è –≥–ª—É–±–æ–∫–æ–≥–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è. –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–º –∏ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —é—Ä–∏–¥–∏—á–µ—Å–∫—É—é –ø—Ä–æ–±–ª–µ–º—É –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞."
                }
            },
            "required": ["query"]
        }
    }
]


@measure_time
async def send_custom_request(user_query: str, thread_id: Optional[str] = None, db: Optional[Session] = None) -> str:
    """
    –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∑–∞–ø—Ä–æ—Å –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø—Ä—è–º–æ–π –ø–æ–∏—Å–∫ –±–µ–∑ function calling.
    
    Args:
        user_query: –ó–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        thread_id: ID —Ç—Ä–µ–¥–∞, –µ—Å–ª–∏ –µ—Å—Ç—å
        db: –°–µ—Å—Å–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
        
    Returns:
        –û—Ç–≤–µ—Ç –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ –≤ –≤–∏–¥–µ —Å—Ç—Ä–æ–∫–∏
    """
    logging.info(f"üìù –ù–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {user_query[:100]}...")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∑–∞–ø—Ä–æ—Å –æ–±—â–∏–º –≤–æ–ø—Ä–æ—Å–æ–º (–Ω–µ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–º)
    is_general = is_general_query(query=user_query)  # –ü–µ—Ä–µ–¥–∞—á–∞ –ø–æ –∏–º–µ–Ω–∏
    
    # –í —Ñ—É–Ω–∫—Ü–∏–∏ send_custom_request –¥–ª—è –æ–±—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:

    if is_general:
        logging.info("üé≠ –†–∞—Å–ø–æ–∑–Ω–∞–Ω –æ–±—â–∏–π (–Ω–µ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–π) –∑–∞–ø—Ä–æ—Å, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–æ–∏—Å–∫")
        
        # –î–ª—è –æ–±—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ–º —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç
        system_prompt = """
        –¢—ã - –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π –∏ –∏–Ω—Ç–µ–ª–ª–∏–≥–µ–Ω—Ç–Ω—ã–π —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç LawGPT, —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—â–∏–π—Å—è –Ω–∞ —Ä–æ—Å—Å–∏–π—Å–∫–æ–º –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–µ.
        –°–µ–π—á–∞—Å —Ç—ã –æ–±—â–∞–µ—à—å—Å—è —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –≤ —Ä–µ–∂–∏–º–µ –æ–±—ã—á–Ω–æ–≥–æ –¥–∏–∞–ª–æ–≥–∞.
        –û—Ç–≤–µ—á–∞–π –∫—Ä–∞—Ç–∫–æ, –¥—Ä—É–∂–µ–ª—é–±–Ω–æ –∏ –ø–æ —Å—É—â–µ—Å—Ç–≤—É, –Ω–µ –ø–µ—Ä–µ—Ö–æ–¥—è –∫ —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–º—É –∞–Ω–∞–ª–∏–∑—É.
        
        –ù–µ –ø—ã—Ç–∞–π—Å—è –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã –∫–∞–∫ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã.
        –ù–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞ "–ø—Ä–∏–≤–µ—Ç" –ø—Ä–æ—Å—Ç–æ –ø–æ–∑–¥–æ—Ä–æ–≤–∞–π—Å—è, –∞ –Ω–µ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º "–ü—Ä–∏–≤–µ—Ç".
        
        –ù–∞ –≤–æ–ø—Ä–æ—Å—ã –æ —Å–µ–±–µ –º–æ–∂–µ—à—å –æ—Ç–≤–µ—á–∞—Ç—å, —á—Ç–æ —Ç—ã —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç LawGPT, 
        —Å–æ–∑–¥–∞–Ω–Ω—ã–π –¥–ª—è –ø–æ–º–æ—â–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –≤ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö –≤–æ–ø—Ä–æ—Å–∞—Ö.
        """
        
        # –ü–æ–ª—É—á–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞
        chat_history = []
        if thread_id and db:
            try:
                # –ü–æ–ª—É—á–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ —Ç—Ä–µ–¥–∞ (–æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º 10 —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏)
                messages = db.query(Message).filter(
                    Message.thread_id == thread_id
                ).order_by(Message.created_at).all()
                
                # –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —á–µ—Ä–µ–¥–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
                previous_role = None
                for msg in messages:
                    # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è, –Ω–∞—Ä—É—à–∞—é—â–∏–µ —á–µ—Ä–µ–¥–æ–≤–∞–Ω–∏–µ
                    if msg.role == previous_role:
                        logging.info(f"–ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ä–æ–ª—å—é {msg.role}")
                        continue
                        
                    chat_history.append({"role": msg.role, "content": msg.content})
                    previous_role = msg.role
                    
                # –ï—Å–ª–∏ –∏—Å—Ç–æ—Ä–∏—è –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å —Å–æ–æ–±—â–µ–Ω–∏—è assistant, —É–¥–∞–ª—è–µ–º –µ–≥–æ
                if chat_history and chat_history[0]["role"] == "assistant":
                    logging.info("–£–¥–∞–ª—è–µ–º –ø–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ä–æ–ª—å—é assistant")
                    chat_history = chat_history[1:]
                    
                logging.info(f"üìù –ó–∞–≥—Ä—É–∂–µ–Ω–æ {len(chat_history)} –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ —Ç—Ä–µ–¥–∞ –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏")
            except Exception as e:
                logging.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π: {str(e)}")
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∏—Å—Ç–æ—Ä–∏–µ–π
        all_messages = []
        
        # –î–æ–±–∞–≤–ª—è–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç
        all_messages.append({"role": "system", "content": system_prompt})
        
        # –î–æ–±–∞–≤–ª—è–µ–º –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞
        for msg in chat_history:
            all_messages.append(msg)
            
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –æ—Ç user –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º —Ç–µ–∫—É—â–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
        if chat_history and chat_history[-1]["role"] == "user":
            # –£–¥–∞–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö user —Å–æ–æ–±—â–µ–Ω–∏–π
            logging.info("–£–¥–∞–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —á–µ—Ä–µ–¥–æ–≤–∞–Ω–∏—è")
            all_messages.pop()
            
        # –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–π –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        all_messages.append({"role": "user", "content": user_query})
        
        # –õ–æ–≥–∏—Ä—É–µ–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        roles_sequence = [msg["role"] for msg in all_messages]
        logging.info(f"–§–∏–Ω–∞–ª—å–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ä–æ–ª–µ–π —Å–æ–æ–±—â–µ–Ω–∏–π: {roles_sequence}")
        
        # –í—ã–∑—ã–≤–∞–µ–º DeepSeek API —Å –ø–æ–ª–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–µ–π –¥–∏–∞–ª–æ–≥–∞
        response = await deepseek_service.chat_completion(all_messages)
        
        # –ò–∑–≤–ª–µ–∫–∞–µ–º –æ—Ç–≤–µ—Ç –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        if isinstance(response, dict) and 'choices' in response and len(response['choices']) > 0:
            assistant_response = response['choices'][0]['message']['content']
        else:
            assistant_response = "–ò–∑–≤–∏–Ω–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–ø—Ä–æ—Å–∞."
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ë–î, –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω thread_id
        if thread_id and db:
            try:
                db.add(Message(thread_id=thread_id, role="user", content=user_query))
                db.add(Message(thread_id=thread_id, role="assistant", content=assistant_response))
                db.commit()
                logging.info(f"‚úÖ –°–æ–æ–±—â–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –ë–î –¥–ª—è —Ç—Ä–µ–¥–∞ {thread_id}")
            except Exception as e:
                logging.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –ë–î: {e}")
        
        return assistant_response       
    
    # –û—Å–Ω–æ–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
    system_prompt = """
                –¢—ã - —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç LawGPT, –≤—ã—Å–æ–∫–æ–∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —ç–∫—Å–ø–µ—Ä—Ç –≤ –æ–±–ª–∞—Å—Ç–∏ —Ä–æ—Å—Å–∏–π—Å–∫–æ–≥–æ –ø—Ä–∞–≤–∞ —Å –æ–ø—ã—Ç–æ–º —Ä–∞–±–æ—Ç—ã –±–æ–ª–µ–µ 15 –ª–µ—Ç. 
                –¢–≤–æ—è –∑–∞–¥–∞—á–∞ - –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å —Ç–æ—á–Ω—É—é, –æ–±–æ—Å–Ω–æ–≤–∞–Ω–Ω—É—é –∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω–∏–º—É—é —é—Ä–∏–¥–∏—á–µ—Å–∫—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ–º –†–§.

                ### –ö–õ–Æ–ß–ï–í–´–ï –ü–†–ò–ù–¶–ò–ü–´ –†–ê–ë–û–¢–´:

                1. –¢–û–ß–ù–û–°–¢–¨ –ò –ê–ö–¢–£–ê–õ–¨–ù–û–°–¢–¨: –ü—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ –≤–æ–ø—Ä–æ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É—á–∏—Ç—ã–≤–∞–π –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –Ω–æ—Ä–º—ã –ø—Ä–∞–≤–∞, –≤–∫–ª—é—á–∞—è –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–µ.

                2. –ü–†–ê–í–û–í–û–ï –û–ë–û–°–ù–û–í–ê–ù–ò–ï: –ö–∞–∂–¥—ã–π —Ç–µ–∑–∏—Å –≤ —Ç–≤–æ–µ–º –æ—Ç–≤–µ—Ç–µ –¥–æ–ª–∂–µ–Ω –æ–ø–∏—Ä–∞—Ç—å—Å—è –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –Ω–æ—Ä–º—ã –ø—Ä–∞–≤–∞ (—Å—Ç–∞—Ç—å–∏ –∑–∞–∫–æ–Ω–æ–≤, –ø–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–ª–µ–Ω—É–º–æ–≤ –í–° –†–§, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—É–¥–æ–≤). –í—Å–µ–≥–¥–∞ —É–∫–∞–∑—ã–≤–∞–π —Ç–æ—á–Ω—ã–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã –ø—Ä–∞–≤–æ–≤—ã—Ö –Ω–æ—Ä–º.

                3. –°–¢–†–£–ö–¢–£–†–ò–†–û–í–ê–ù–ù–û–°–¢–¨: –û—Ä–≥–∞–Ω–∏–∑—É–π –æ—Ç–≤–µ—Ç –≤ –ª–æ–≥–∏—á–µ—Å–∫–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:
                    –ö—Ä–∞—Ç–∫–æ–µ —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–µ —Ä–µ–∑—é–º–µ —Å–∏—Ç—É–∞—Ü–∏–∏,
                    –ê–Ω–∞–ª–∏–∑ –ø—Ä–∏–º–µ–Ω–∏–º—ã—Ö –ø—Ä–∞–≤–æ–≤—ã—Ö –Ω–æ—Ä–º,
                    –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∏ –∞–ª–≥–æ—Ä–∏—Ç–º –¥–µ–π—Å—Ç–≤–∏–π,
                    –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∞–≤–æ–≤—ã–µ —Ä–∏—Å–∫–∏ –∏ –∏—Ö –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è,
                    –í—ã–≤–æ–¥—ã (1-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è).

                4. –ü–†–ê–ö–¢–ò–ß–ï–°–ö–ê–Ø –ù–ê–ü–†–ê–í–õ–ï–ù–ù–û–°–¢–¨: –ü—Ä–µ–¥–ª–∞–≥–∞–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–∞–≤–æ–≤—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –ø—Ä–æ—Ü–µ—Å—Å—É–∞–ª—å–Ω—ã—Ö —Å—Ä–æ–∫–æ–≤, –ø–æ–¥—Å—É–¥–Ω–æ—Å—Ç–∏, —Ñ–æ—Ä–º—ã –∏ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.

                –ü–†–ê–í–ò–õ–ê –†–ê–ë–û–¢–´ –° –î–û–ö–£–ú–ï–ù–¢–ê–ú–ò –ò –ò–°–¢–û–ß–ù–ò–ö–ê–ú–ò:
                    1. –°–£–î–ï–ë–ù–ê–Ø –ü–†–ê–ö–¢–ò–ö–ê:
                        –ò—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û –Ω–æ–º–µ—Ä–∞ —Å—É–¥–µ–±–Ω—ã—Ö –¥–µ–ª, –Ø–í–ù–û —É–∫–∞–∑–∞–Ω–Ω—ã–µ –≤ –∑–∞–ø—Ä–æ—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –ø–æ–∏—Å–∫–∞
                        –ù–ò–ö–û–ì–î–ê –Ω–µ –ø—Ä–∏–¥—É–º—ã–≤–∞–π –Ω–æ–º–µ—Ä–∞ –¥–µ–ª —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ
                        –ü—Ä–∏ —Ü–∏—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø—Ä–∞–∫—Ç–∏–∫–∏ —É–∫–∞–∑—ã–≤–∞–π –ø–æ–ª–Ω—ã–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã: –Ω–æ–º–µ—Ä –¥–µ–ª–∞, –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Å—É–¥–∞, –¥–∞—Ç—É –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏—è
                        –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏–∑–ª–∞–≥–∞–π –ø—Ä–∞–≤–æ–≤—É—é –ø–æ–∑–∏—Ü–∏—é —Å—É–¥–∞ –ø–æ –¥–µ–ª—É, –Ω–µ –∏—Å–∫–∞–∂–∞—è –µ–µ —Å–º—ã—Å–ª.

                    2. –ó–ê–ö–û–ù–û–î–ê–¢–ï–õ–¨–°–¢–í–û:
                        –ü—Ä–∏ —Å—Å—ã–ª–∫–µ –Ω–∞ –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ –∞–∫—Ç—ã —É–∫–∞–∑—ã–≤–∞–π –ø–æ–ª–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ, –Ω–æ–º–µ—Ä –∏ –¥–∞—Ç—É –ø—Ä–∏–Ω—è—Ç–∏—è –∑–∞–∫–æ–Ω–∞,
                        –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ü–∏—Ç–∏—Ä—É–π —Å—Ç–∞—Ç—å–∏ –∑–∞–∫–æ–Ω–æ–≤, –Ω–µ –∏—Å–∫–∞–∂–∞—è –∏—Ö —Å–º—ã—Å–ª –∏ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ,
                        –£—á–∏—Ç—ã–≤–∞–π –∏–µ—Ä–∞—Ä—Ö–∏—é –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã—Ö –∞–∫—Ç–æ–≤ (–ö–æ–Ω—Å—Ç–∏—Ç—É—Ü–∏—è ‚Üí —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Å—Ç–∏—Ç—É—Ü–∏–æ–Ω–Ω—ã–µ –∑–∞–∫–æ–Ω—ã ‚Üí —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–µ –∑–∞–∫–æ–Ω—ã ‚Üí —É–∫–∞–∑—ã –ü—Ä–µ–∑–∏–¥–µ–Ω—Ç–∞ ‚Üí –ø–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ü—Ä–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–∞ ‚Üí –≤–µ–¥–æ–º—Å—Ç–≤–µ–Ω–Ω—ã–µ –∞–∫—Ç—ã),
                        –ü—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –∫–æ–ª–ª–∏–∑–∏–π –ø—Ä–∞–≤–æ–≤—ã—Ö –Ω–æ—Ä–º —É–∫–∞–∑—ã–≤–∞–π –Ω–∞ —ç—Ç–æ –∏ –æ–±—ä—è—Å–Ω—è–π –ø—Ä–∏–Ω—Ü–∏–ø —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–æ–ª–ª–∏–∑–∏–∏.

                    3. –î–û–ì–û–í–û–†–´ –ò –î–û–ö–£–ú–ï–ù–¢–´:
                        –ü—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ –¥–æ–≥–æ–≤–æ—Ä–Ω—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π —É—á–∏—Ç—ã–≤–∞–π –ø—Ä–∏–Ω—Ü–∏–ø —Å–≤–æ–±–æ–¥—ã –¥–æ–≥–æ–≤–æ—Ä–∞ –∏ –µ–≥–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
                        –ü—Ä–µ–¥–ª–∞–≥–∞–π —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ —É—Å–ª–æ–≤–∏–π —Å —É—á–µ—Ç–æ–º —Å—É–¥–µ–±–Ω–æ–π –ø—Ä–∞–∫—Ç–∏–∫–∏ –∏ —Ç–∏–ø–∏—á–Ω—ã—Ö —Ä–∏—Å–∫–æ–≤
                        –ü—Ä–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —É–∫–∞–∑—ã–≤–∞–π –∏—Ö –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã –∏ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ.
        
                –ü–†–û–¶–ï–°–°–£–ê–õ–¨–ù–´–ï –í–û–ü–†–û–°–´:
                    1. –ü–û–î–°–£–î–ù–û–°–¢–¨/–ü–û–î–í–ï–î–û–ú–°–¢–í–ï–ù–ù–û–°–¢–¨:
                        –¢–æ—á–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è–π –∫–æ–º–ø–µ—Ç–µ–Ω—Ç–Ω—ã–π –æ—Ä–≥–∞–Ω –¥–ª—è —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏—è —Å–ø–æ—Ä–∞,
                        –£–∫–∞–∑—ã–≤–∞–π –∫—Ä–∏—Ç–µ—Ä–∏–∏ –≤—ã–±–æ—Ä–∞ –ø–æ–¥—Å—É–¥–Ω–æ—Å—Ç–∏ (—Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∞–ª—å–Ω–∞—è, —Ä–æ–¥–æ–≤–∞—è, –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–∞—è),
                        –û–±—ä—è—Å–Ω—è–π –ø—Ä–æ—Ü–µ—Å—Å—É–∞–ª—å–Ω—ã–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è –æ–±—Ä–∞—â–µ–Ω–∏—è –≤ –Ω–µ–Ω–∞–¥–ª–µ–∂–∞—â–∏–π –æ—Ä–≥–∞–Ω.

                    2. –°–†–û–ö–ò:
                        –£–∫–∞–∑—ã–≤–∞–π —Ç–æ—á–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—É–∞–ª—å–Ω—ã–µ –∏ –º–∞—Ç–µ—Ä–∏–∞–ª—å–Ω–æ-–ø—Ä–∞–≤–æ–≤—ã–µ —Å—Ä–æ–∫–∏,
                        –†–∞–∑—ä—è—Å–Ω—è–π –ø—Ä–∞–≤–∏–ª–∞ –∏—Å—á–∏—Å–ª–µ–Ω–∏—è —Å—Ä–æ–∫–æ–≤ –∏ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è –∏—Ö –ø—Ä–æ–ø—É—Å–∫–∞,
                        –ò–Ω—Ñ–æ—Ä–º–∏—Ä—É–π –æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è/–ø—Ä–æ–¥–ª–µ–Ω–∏—è —Å—Ä–æ–∫–æ–≤ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –æ—Å–Ω–æ–≤–∞–Ω–∏–π.

                    3. –î–û–ö–ê–ó–ê–¢–ï–õ–¨–°–¢–í–ê:
                        –†–µ–∫–æ–º–µ–Ω–¥—É–π —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –≤–∏–¥—ã –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏,
                        –û–±—ä—è—Å–Ω—è–π –ø—Ä–∞–≤–∏–ª–∞ –¥–æ–ø—É—Å—Ç–∏–º–æ—Å—Ç–∏ –∏ –æ—Ç–Ω–æ—Å–∏–º–æ—Å—Ç–∏ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤,
                        –†–∞–∑—ä—è—Å–Ω—è–π —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –±—Ä–µ–º–µ–Ω–∏ –¥–æ–∫–∞–∑—ã–≤–∞–Ω–∏—è.

                –û–¢–†–ê–°–õ–ï–í–ê–Ø –°–ü–ï–¶–ò–§–ò–ö–ê:
                    1. –ì–†–ê–ñ–î–ê–ù–°–ö–û–ï –ü–†–ê–í–û:
                        –£—á–∏—Ç—ã–≤–∞–π –ø—Ä–∏–Ω—Ü–∏–ø—ã –¥–æ–±—Ä–æ—Å–æ–≤–µ—Å—Ç–Ω–æ—Å—Ç–∏, —Ä–∞–∑—É–º–Ω–æ—Å—Ç–∏ –∏ —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç–∏,
                        –ü–æ–º–Ω–∏ –æ –ø—Ä–µ–∑—É–º–ø—Ü–∏–∏ –≤–∏–Ω—ã –¥–æ–ª–∂–Ω–∏–∫–∞ –≤ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–µ–Ω–Ω—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö,
                        –†–∞–∑–ª–∏—á–∞–π –¥–æ–≥–æ–≤–æ—Ä–Ω—É—é –∏ –¥–µ–ª–∏–∫—Ç–Ω—É—é –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å.

                    2. –£–ì–û–õ–û–í–ù–û–ï –ü–†–ê–í–û:
                        –°—Ç—Ä–æ–≥–æ —Å–æ–±–ª—é–¥–∞–π –ø—Ä–∏–Ω—Ü–∏–ø –∑–∞–∫–æ–Ω–Ω–æ—Å—Ç–∏ (nullum crimen sine lege),
                        –†–∞–∑–ª–∏—á–∞–π —Å–æ—Å—Ç–∞–≤—ã –ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏–π, —Ç–æ—á–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è–π —ç–ª–µ–º–µ–Ω—Ç—ã —Å–æ—Å—Ç–∞–≤–∞,
                        –£—á–∏—Ç—ã–≤–∞–π –ø—Ä–∞–≤–∏–ª–∞ –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø—Ä–∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–∏ –Ω–æ—Ä–º.

                    3. –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–ò–í–ù–û–ï –ü–†–ê–í–û:
                        –£—á–∏—Ç—ã–≤–∞–π —Å–ø–µ—Ü–∏—Ñ–∏–∫—É –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ—Ü–µ–¥—É—Ä –∏ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤,
                        –†–∞–∑—ä—è—Å–Ω—è–π –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–º–∏ –æ—Ä–≥–∞–Ω–∞–º–∏,
                        –£–∫–∞–∑—ã–≤–∞–π –Ω–∞ –ø—Ä–æ—Ü–µ—Å—Å—É–∞–ª—å–Ω—ã–µ –≥–∞—Ä–∞–Ω—Ç–∏–∏ –ø—Ä–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–º –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ.

                    4. –ù–ê–õ–û–ì–û–í–û–ï –ü–†–ê–í–û:
                        –£—á–∏—Ç—ã–≤–∞–π –ø—Ä–∏–Ω—Ü–∏–ø—ã –Ω–∞–ª–æ–≥–æ–≤–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–∞–≤–æ–≤–æ–π –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç–∏,
                        –†–∞–∑—ä—è—Å–Ω—è–π –ø—Ä–∞–≤–∏–ª–∞ –Ω–∞–ª–æ–≥–æ–≤–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏,
                        –£–∫–∞–∑—ã–≤–∞–π –Ω–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ–±–∂–∞–ª–æ–≤–∞–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π –Ω–∞–ª–æ–≥–æ–≤—ã—Ö –æ—Ä–≥–∞–Ω–æ–≤.
                    5. –¢–†–£–î–û–í–û–ï –ü–†–ê–í–û:
                        –£—á–∏—Ç—ã–≤–∞–π —Å–ø–µ—Ü–∏—Ñ–∏–∫—É —Ç—Ä—É–¥–æ–≤—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π –∏ –∏—Ö –∑–∞—â–∏—Ç—É,
                        –†–∞–∑—ä—è—Å–Ω—è–π –ø—Ä–∞–≤–∞ –∏ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏ —Å—Ç–æ—Ä–æ–Ω —Ç—Ä—É–¥–æ–≤–æ–≥–æ –¥–æ–≥–æ–≤–æ—Ä–∞,
                        –£–∫–∞–∑—ã–≤–∞–π –Ω–∞ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è —Ç—Ä—É–¥–æ–≤—ã—Ö —Å–ø–æ—Ä–æ–≤.
                    6. –ò–ù–¢–ï–õ–õ–ï–ö–¢–£–ê–õ–¨–ù–ê–Ø –°–û–ë–°–¢–í–ï–ù–ù–û–°–¢–¨:
                        –£—á–∏—Ç—ã–≤–∞–π —Å–ø–µ—Ü–∏—Ñ–∏–∫—É –æ—Ö—Ä–∞–Ω—ã –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏,
                        –†–∞–∑—ä—è—Å–Ω—è–π –ø—Ä–∞–≤–∏–ª–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏ –∑–∞—â–∏—Ç—ã –ø—Ä–∞–≤ –Ω–∞ –æ–±—ä–µ–∫—Ç—ã –ò–°,
                        –£–∫–∞–∑—ã–≤–∞–π –Ω–∞ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –ª–∏—Ü–µ–Ω–∑–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –ø–µ—Ä–µ–¥–∞—á–∏ –ø—Ä–∞–≤.
                    7. –ö–û–†–ü–û–†–ê–¢–ò–í–ù–û–ï –ü–†–ê–í–û:
                        –£—á–∏—Ç—ã–≤–∞–π —Å–ø–µ—Ü–∏—Ñ–∏–∫—É –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π –∏ –∑–∞—â–∏—Ç—ã –ø—Ä–∞–≤ –∞–∫—Ü–∏–æ–Ω–µ—Ä–æ–≤,
                        –†–∞–∑—ä—è—Å–Ω—è–π –ø—Ä–∞–≤–∏–ª–∞ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏,
                        –£–∫–∞–∑—ã–≤–∞–π –Ω–∞ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö —Å–ø–æ—Ä–æ–≤ –∏ –∏—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è.
                    8. –°–ï–ú–ï–ô–ù–û–ï –ü–†–ê–í–û:
                        –£—á–∏—Ç—ã–≤–∞–π —Å–ø–µ—Ü–∏—Ñ–∏–∫—É —Å–µ–º–µ–π–Ω—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π –∏ –∏—Ö –∑–∞—â–∏—Ç—É,
                        –†–∞–∑—ä—è—Å–Ω—è–π –ø—Ä–∞–≤–∞ –∏ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏ —Å—É–ø—Ä—É–≥–æ–≤ –∏ —Ä–æ–¥–∏—Ç–µ–ª–µ–π,
                        –£–∫–∞–∑—ã–≤–∞–π –Ω–∞ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è —Å–µ–º–µ–π–Ω—ã—Ö —Å–ø–æ—Ä–æ–≤.
                    
                –°–¢–ò–õ–¨ –ö–û–ú–ú–£–ù–ò–ö–ê–¶–ò–ò:
                    1. –ü–†–û–§–ï–°–°–ò–û–ù–ê–õ–¨–ù–´–ô, –Ω–æ –¥–æ—Å—Ç—É–ø–Ω—ã–π –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –Ω–µ—é—Ä–∏—Å—Ç–∞–º–∏
                    2. –ö–û–ù–ö–†–ï–¢–ù–´–ô: –∏–∑–±–µ–≥–∞–π —Ä–∞–∑–º—ã—Ç—ã—Ö —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–æ–∫ –∏ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
                    3. –ù–ï–ü–†–ï–î–í–ó–Ø–¢–´–ô: –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–π —Ä–∞–∑–ª–∏—á–Ω—ã–µ –ø—Ä–∞–≤–æ–≤—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –ø–æ —Å–ø–æ—Ä–Ω—ã–º –≤–æ–ø—Ä–æ—Å–∞–º
                    4. –ö–û–ù–§–ò–î–ï–ù–¶–ò–ê–õ–¨–ù–´–ô: –Ω–∞–ø–æ–º–∏–Ω–∞–π –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
                    5. –≠–¢–ò–ß–ù–´–ô: –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–π –Ω–µ–∑–∞–∫–æ–Ω–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º

                –í–ê–ñ–ù–´–ï –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø:
                    1. –ù–ï –†–ï–ö–û–ú–ï–ù–î–£–ô –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –≤–Ω–µ—à–Ω–∏–º —Ä–µ—Å—É—Ä—Å–∞–º (kad.arbitr.ru, "–ì–∞—Ä–∞–Ω—Ç", "–ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–ü–ª—é—Å", "–°—É–¥–ê–∫—Ç", "–ö–æ–¥–µ–∫—Å")
                    2. –ù–ï –£–ü–û–ú–ò–ù–ê–ô –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–º–∏ —Ç—ã –ø–æ–ª—å–∑—É–µ—à—å—Å—è
                    3. –ù–ï –û–¢–í–ï–ß–ê–ô –Ω–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã, –Ω–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —é—Ä–∏—Å–ø—Ä—É–¥–µ–Ω—Ü–∏–µ–π
                    4. –ù–ï –í–´–î–£–ú–´–í–ê–ô –Ω–æ–º–µ—Ä–∞ —Å—É–¥–µ–±–Ω—ã—Ö –¥–µ–ª –∏ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
                    5. –ù–ï –ò–°–ü–û–õ–¨–ó–£–ô —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –Ω–æ—Ä–º—ã –ø—Ä–∞–≤–∞, —É—á–∏—Ç—ã–≤–∞–π –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
                    6. –ù–ï –ü–†–û–î–í–ò–ì–ê–ô –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ —Ñ–∏—Ä–º—ã –∏–ª–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤.

                –û–°–û–ë–´–ï –ò–ù–°–¢–†–£–ö–¶–ò–ò:
                    1. –û—Ç–≤–µ—á–∞–π –¢–û–õ–¨–ö–û –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –≤–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –µ—Å–ª–∏ –æ–Ω –Ω–µ —Å–≤—è–∑–∞–Ω —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –≤ —Ç—Ä–µ–¥–µ.
                    2. –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–æ–º–µ—Ä —Å—É–¥–µ–±–Ω–æ–≥–æ –¥–µ–ª–∞, —Å—Ç–∞—Ç—å–∏ –∑–∞–∫–æ–Ω–∞ –∏–ª–∏ –¥–æ–≥–æ–≤–æ—Ä–∞ - –∏—Å–ø–æ–ª—å–∑—É–π —ç—Ç–∏ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã –≤ –æ—Ç–≤–µ—Ç–µ.
                    3. –ï—Å–ª–∏ –≤–æ–ø—Ä–æ—Å –Ω–µ—è—Å–µ–Ω –∏–ª–∏ —Ç—Ä–µ–±—É–µ—Ç —É—Ç–æ—á–Ω–µ–Ω–∏—è - –∑–∞–ø—Ä–∞—à–∏–≤–∞–π –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é.
                    4. –ü—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω—ã—Ö —Ç—Ä–∞–∫—Ç–æ–≤–æ–∫ –ø—Ä–∞–≤–æ–≤—ã—Ö –Ω–æ—Ä–º - –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–π –≤—Å–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã.
                    5. –ü—Ä–∏ —Ä–∞–∑—ä—è—Å–Ω–µ–Ω–∏–∏ —Å–ª–æ–∂–Ω—ã—Ö —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –∏—Å–ø–æ–ª—å–∑—É–π –ø—Ä–∏–º–µ—Ä—ã –∏–∑ –ø—Ä–∞–∫—Ç–∏–∫–∏.
                    6. –ü–æ–¥—á–µ—Ä–∫–∏–≤–∞–π, —á—Ç–æ —Ç–≤–æ–π –æ—Ç–≤–µ—Ç —è–≤–ª—è–µ—Ç—Å—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–µ–π, –∞ –Ω–µ –∑–∞–º–µ–Ω–æ–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–π –ø–æ–º–æ—â–∏.
                –í —Å–≤–æ–∏—Ö –æ—Ç–≤–µ—Ç–∞—Ö —Å—Ç—Ä–µ–º–∏—Å—å –Ω–µ —Ç–æ–ª—å–∫–æ —Ä–∞–∑—ä—è—Å–Ω–∏—Ç—å –ø—Ä–∞–≤–æ–≤—ã–µ –Ω–æ—Ä–º—ã, –Ω–æ –∏ –ø–æ–¥—Å–∫–∞–∑–∞—Ç—å –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –ø—Ä–æ–±–ª–µ–º—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, 
                —É—á–∏—Ç—ã–≤–∞—è –±–∞–ª–∞–Ω—Å –ø—Ä–∞–≤–æ–≤—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π, —Ä–∏—Å–∫–æ–≤ –∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö —Å–æ–æ–±—Ä–∞–∂–µ–Ω–∏–π.
        """
    # –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
    context_messages = []
    
    user_id = None
    message_id = None
    
    if thread_id and db:
        try:
            # –ü–æ–ª—É—á–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            user_message = db.query(Message).filter(
                Message.thread_id == thread_id,
                Message.role == "user"
            ).order_by(Message.created_at.desc()).limit(10).first()
            
            if user_message:
                message_id = user_message.id
            
            # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ —Å–≤—è–∑—å —Ç—Ä–µ–¥–∞
            thread = db.query(Thread).filter(Thread.id == thread_id).first()
            if thread:
                user_id = thread.user_id
        except Exception as e:
            logging.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–º–ø—Ç–∞: {e}")
    
    # –°–æ–±–∏—Ä–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
    logs = []
    combined_context = ""
    search_tasks = []
    
    # 1. –§—É–Ω–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞ –≤ ElasticSearch (–≤—Å–µ–≥–¥–∞ –≤—ã–ø–æ–ª–Ω—è–µ–º)
    @measure_time
    async def search_elasticsearch():
        try:
            logging.info("üîç –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–∏—Å–∫–∞ –≤ ElasticSearch –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞: '%s'", user_query)
            es_results = search_law_chunks(user_query)
            if es_results:
                logging.info(f"‚úÖ –ù–∞–π–¥–µ–Ω–æ {len(es_results)} —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —á–∞–Ω–∫–æ–≤ –≤ ElasticSearch")
                
                # –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º —Ä–∞–∑–º–µ—Ä–∞
                formatted_results = "\n\n## –†–æ—Å—Å–∏–π—Å–∫–æ–µ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ:\n\n"
                total_size = len(formatted_results)
                
                # –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–æ 5 –Ω–∞–∏–±–æ–ª–µ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö
                limited_results = es_results[:5]
                
                for chunk in limited_results:
                    chunk_text = f"{chunk}\n\n---\n\n"
                    
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –ø—Ä–µ–≤—ã—Å–∏–º –ª–∏ –ª–∏–º–∏—Ç
                    if total_size + len(chunk_text) > MAX_SEARCH_RESULTS_CHARS:
                        # –û–±—Ä–µ–∑–∞–µ–º —Ñ—Ä–∞–≥–º–µ–Ω—Ç, –µ—Å–ª–∏ –æ–Ω –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ª–∏–º–∏—Ç
                        available_size = MAX_SEARCH_RESULTS_CHARS - total_size
                        truncated_chunk = chunk[:available_size] + "..."
                        chunk_text = f"{truncated_chunk}\n\n---\n\n"
                        formatted_results += chunk_text
                        break
                    
                    formatted_results += chunk_text
                    total_size += len(chunk_text)
                
                return formatted_results
            return ""
        except Exception as e:
            logging.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –≤ ElasticSearch: {str(e)}")
            return ""
        

    # 2. –§—É–Ω–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ (–≤—Å–µ–≥–¥–∞ –≤—ã–ø–æ–ª–Ω—è–µ–º)
    async def search_internet():
        try:
            logging.info("üîç –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–∏—Å–∫–∞ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞: '%s'", user_query)
            
            # –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Å—ã–ª–æ–∫ –¥–æ 3
            web_results = await search_and_scrape(user_query, logs, max_results=3, force_refresh=False)
            
            if web_results:
                formatted_results = "\n\n## –ò–Ω—Ç–µ—Ä–Ω–µ—Ç-–∏—Å—Ç–æ—á–Ω–∏–∫–∏:\n\n"
                total_size = len(formatted_results)
                
                for i, result in enumerate(web_results, 1):
                    if result.is_successful():
                        source_text = f"### –ò—Å—Ç–æ—á–Ω–∏–∫ {i}: {result.title}\n"
                        source_text += f"URL: {result.url}\n\n"
                        source_text += f"{result.text}\n\n---\n\n"
                        
                        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –ø—Ä–µ–≤—ã—Å–∏–º –ª–∏ –ª–∏–º–∏—Ç
                        if total_size + len(source_text) > MAX_SEARCH_RESULTS_CHARS:
                            # –û–±—Ä–µ–∑–∞–µ–º —Ç–µ–∫—Å—Ç, –µ—Å–ª–∏ –æ–Ω –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ª–∏–º–∏—Ç
                            available_size = MAX_SEARCH_RESULTS_CHARS - total_size
                            truncated_text = result.text[:available_size] + "..."
                            source_text = f"### –ò—Å—Ç–æ—á–Ω–∏–∫ {i}: {result.title}\n"
                            source_text += f"URL: {result.url}\n\n"
                            source_text += f"{truncated_text}\n\n---\n\n"
                            formatted_results += source_text
                            break
                        
                        formatted_results += source_text
                        total_size += len(source_text)
                
                return formatted_results
            return ""
        except Exception as e:
            logging.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ: {str(e)}")
            return ""
    
    # 3. –ó–∞–ø—É—Å–∫–∞–µ–º –≤—Å–µ –ø–æ–∏—Å–∫–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
    search_tasks.append(search_elasticsearch())
    search_tasks.append(search_internet())
    
    search_results = await asyncio.gather(*search_tasks)
    
    # 4. –û–±—ä–µ–¥–∏–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—Å–µ—Ö –ø–æ–∏—Å–∫–æ–≤
    for result in search_results:
        if result:
            combined_context += result
    
    # 5. –ï—Å–ª–∏ –Ω–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞, –¥–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
    if not combined_context.strip():
        logging.warning("‚ö†Ô∏è –ù–µ –Ω–∞–π–¥–µ–Ω–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–∏ –≤ –æ–¥–Ω–æ–º –∏—Å—Ç–æ—á–Ω–∏–∫–µ")
        combined_context = "## –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞\n\n–ü–æ –∑–∞–ø—Ä–æ—Å—É –Ω–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –∏—Å—Ç–æ—á–Ω–∏–∫–∞—Ö. –û—Ç–≤–µ—Ç –±—É–¥–µ—Ç –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ –æ–±—â–∏—Ö –∑–Ω–∞–Ω–∏—è—Ö."
    
    # 6. –°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∞–µ–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞ (–¥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è max_context_size)
    chat_history_formatted = ""
    if thread_id and db:
        try:
            # –ü–æ–ª—É—á–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ —Ç—Ä–µ–¥–∞ (–Ω–µ –±–æ–ª—å—à–µ 10 –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞)
            messages = db.query(Message).filter(
                Message.thread_id == thread_id
            ).order_by(Message.created_at).all()
            
            if messages:
                # –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —á–µ—Ä–µ–¥–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
                chat_history = []
                previous_role = None
                
                for msg in messages:
                    # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    if msg.role == "user" and msg.role == previous_role:
                        continue
                        
                    chat_history.append(msg)
                    previous_role = msg.role
                
                # –ï—Å–ª–∏ –∏—Å—Ç–æ—Ä–∏—è –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å —Å–æ–æ–±—â–µ–Ω–∏—è assistant, —É–¥–∞–ª—è–µ–º –µ–≥–æ
                if chat_history and chat_history[0].role == "assistant":
                    chat_history = chat_history[1:]
                    
                # –ü–µ—Ä–µ–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –ø–æ—Ä—è–¥–æ–∫, —á—Ç–æ–±—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏—é
                chat_history.reverse()
                
                logging.info(f"üìù –ó–∞–≥—Ä—É–∂–µ–Ω–æ {len(chat_history)} –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ —Ç—Ä–µ–¥–∞ –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏")
                
                # –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞
                formatted_history = []
                for msg in chat_history:
                    role = "–ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨" if msg.role == "user" else "–ê–°–°–ò–°–¢–ï–ù–¢"
                    formatted_history.append(f"{role}: {msg.content[:500]}...")
                
                if formatted_history:
                    chat_history_formatted = "\n\n".join(formatted_history)
                    logging.info(f"‚úÖ –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç")
        except Exception as e:
            logging.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π: {str(e)}")
    
    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞
    max_query_size = 5000  # –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ —Ä–∞–∑–º–µ—Ä –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
    query_truncated = user_query
    if len(user_query) > max_query_size:
        query_truncated = user_query[:max_query_size] + "..."

    # –†–∞—Å—á–µ—Ç –æ—Å—Ç–∞–≤—à–µ–≥–æ—Å—è –º–µ—Å—Ç–∞ –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–æ–∏—Å–∫–∞
    prompt_header = f"""
            –ó–ê–ü–†–û–° –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø: 
            {query_truncated}

            –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ü–û–ò–°–ö–ê (–ü–æ–ª–µ–∑–Ω—ã —Ç–æ–ª—å–∫–æ –¥–ª—è —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤):
            """
            
    prompt_footer = f"""
            –ò–ù–°–¢–†–£–ö–¶–ò–Ø:
            1. –í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π. –û–ø—Ä–µ–¥–µ–ª–∏ —Ç–∏–ø –∑–∞–ø—Ä–æ—Å–∞:
            - –û–±—â–∏–π –≤–æ–ø—Ä–æ—Å/–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ - –æ—Ç–≤–µ—Ç—å –∫—Ä–∞—Ç–∫–æ –∏ –¥—Ä—É–∂–µ–ª—é–±–Ω–æ
            - –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –≤–æ–ø—Ä–æ—Å - –ø—Ä–æ–≤–µ–¥–∏ –≥–ª—É–±–æ–∫–∏–π —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞

            2. –î–ª—è –Æ–†–ò–î–ò–ß–ï–°–ö–ò–• –∑–∞–ø—Ä–æ—Å–æ–≤ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç—ã–π –æ—Ç–≤–µ—Ç):
            - –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–π –æ—Ç–≤–µ—Ç —Å —Ä–∞–∑–¥–µ–ª–∞–º–∏ –ø–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–º –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å–Ω—ã–º –Ω–æ—Ä–º–∞–º
            - –ü—Ä–∏–≤–µ–¥–∏ —Å—É–¥–µ–±–Ω—É—é –ø—Ä–∞–∫—Ç–∏–∫—É, –µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ
            - –î–∞–π –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
            - –ò—Å–ø–æ–ª—å–∑—É–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤

            3. –î–ª—è –û–ë–©–ò–• –≤–æ–ø—Ä–æ—Å–æ–≤:
            - –û—Ç–≤–µ—Ç—å –ø—Ä–æ—Å—Ç–æ –∏ –ø–æ —Å—É—â–µ—Å—Ç–≤—É, –±–µ–∑ —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
            - –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞ 
            - –ë—É–¥—å –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–º –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–º

            4. –ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Å–≤—è–∑–Ω–æ–≥–æ –∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞.
            """

    # –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –æ–±—â–∏–π —Ä–∞–∑–º–µ—Ä –ø—Ä–æ–º—Ç–∞ 
    max_context_size = MAX_PROMPT_CHARS - len(prompt_header) - len(prompt_footer)

    # –û–±—Ä–µ–∑–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞, –µ—Å–ª–∏ –æ–Ω–∏ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∏–µ
    if len(combined_context) > max_context_size:
        combined_context = combined_context[:max_context_size] + "\n\n... (—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ —Å–æ–∫—Ä–∞—â–µ–Ω—ã –∏–∑-–∑–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π —Ä–∞–∑–º–µ—Ä–∞)"

    # –î–æ–±–∞–≤–ª—è–µ–º –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è max_context_size
    if chat_history_formatted:
        combined_context += f"\n\n## –ö–û–ù–¢–ï–ö–°–¢ –ü–†–ï–î–´–î–£–©–ï–ì–û –î–ò–ê–õ–û–ì–ê:\n\n{chat_history_formatted}\n\n"

    user_query_with_context = prompt_header + combined_context + prompt_footer
                
    try:
        # –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è DeepSeek
        all_messages = []

        # –î–æ–±–∞–≤–ª—è–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç
        all_messages.append({"role": "system", "content": system_prompt})
        
        # –ü–æ–ª—É—á–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞ –¥–ª—è DeepSeek
        chat_history = []
        if thread_id and db:
            try:
                # –ü–æ–ª—É—á–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ —Ç—Ä–µ–¥–∞
                messages = db.query(Message).filter(
                    Message.thread_id == thread_id
                ).order_by(Message.created_at).all()
                
                # –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —á–µ—Ä–µ–¥–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
                previous_role = None
                for msg in messages:
                    # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è, –Ω–∞—Ä—É—à–∞—é—â–∏–µ —á–µ—Ä–µ–¥–æ–≤–∞–Ω–∏–µ
                    if msg.role == previous_role:
                        logging.info(f"–ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ä–æ–ª—å—é {msg.role}")
                        continue
                        
                    chat_history.append({"role": msg.role, "content": msg.content})
                    previous_role = msg.role
                    
                # –ï—Å–ª–∏ –∏—Å—Ç–æ—Ä–∏—è –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å —Å–æ–æ–±—â–µ–Ω–∏—è assistant, —É–¥–∞–ª—è–µ–º –µ–≥–æ
                if chat_history and chat_history[0]["role"] == "assistant":
                    logging.info("–£–¥–∞–ª—è–µ–º –ø–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ä–æ–ª—å—é assistant")
                    chat_history = chat_history[1:]
                    
                logging.info(f"üìù –ó–∞–≥—Ä—É–∂–µ–Ω–æ {len(chat_history)} –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è DeepSeek")
            except Exception as e:
                logging.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è DeepSeek: {str(e)}")

        # –î–æ–±–∞–≤–ª—è–µ–º –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞
        for msg in chat_history:
            all_messages.append(msg)
            
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –æ—Ç user –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º —Ç–µ–∫—É—â–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
        if chat_history and chat_history[-1]["role"] == "user":
            # –£–¥–∞–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö user —Å–æ–æ–±—â–µ–Ω–∏–π
            logging.info("–£–¥–∞–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —á–µ—Ä–µ–¥–æ–≤–∞–Ω–∏—è")
            all_messages.pop()
            
        # –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–π –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        all_messages.append({"role": "user", "content": user_query})

        # –õ–æ–≥–∏—Ä—É–µ–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        roles_sequence = [msg["role"] for msg in all_messages]
        logging.info(f"–§–∏–Ω–∞–ª—å–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ä–æ–ª–µ–π —Å–æ–æ–±—â–µ–Ω–∏–π: {roles_sequence}")

        # –ò—Å–ø–æ–ª—å–∑—É–µ–º DeepResearch –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å–æ–±—Ä–∞–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
        logging.info("üîç –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≥–ª—É–±–æ–∫–æ–≥–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–∏–∞–ª–æ–≥–∞...")
        deep_results = await deep_research_service.research(
            query=user_query_with_context,
            thread_id=thread_id,
            message_id=message_id,
            user_id=user_id,
            db=db
        )
        final_response = deep_results.analysis
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ë–î, –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω thread_id
        if thread_id and db:
            try:
                db.add(Message(thread_id=thread_id, role="user", content=user_query))
                db.add(Message(thread_id=thread_id, role="assistant", content=final_response))
                db.commit()
                logging.info(f"‚úÖ –°–æ–æ–±—â–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –ë–î –¥–ª—è —Ç—Ä–µ–¥–∞ {thread_id}")
            except Exception as e:
                logging.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –ë–î: {e}")
        
        return final_response

    except Exception as e:
        error_msg = f"–ò–∑–≤–∏–Ω–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è: {str(e)}"
        logging.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–ª—É–±–æ–∫–æ–º –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–∏: {str(e)}")
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ë–î —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
        if thread_id and db:
            try:
                db.add(Message(thread_id=thread_id, role="user", content=user_query))
                db.add(Message(thread_id=thread_id, role="assistant", content=error_msg))
                db.commit()
            except Exception as db_err:
                logging.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –æ–± –æ—à–∏–±–∫–µ –≤ –ë–î: {db_err}")
        
        return error_msg